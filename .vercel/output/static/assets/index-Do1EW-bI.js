import{c as Se,r as w,j as e,a as z,f as Z,b as ne,g as P,d as q,z as y,u as Ee,h as Ae,U as Oe,C as ae,o as de,s as I,i as oe}from"./index-D68JyPnQ.js";import{P as Re,D as qe,C as re}from"./PortalLayout-DFkXF_dG.js";import{a as B,f as S,b as Fe}from"./formatTime-R4Jm2Dpf.js";import{u as ce,a as me}from"./zod-Us8nOtev.js";import{C as $}from"./calendar-sVqVbs5g.js";import{C as Pe,a as Le,L as xe}from"./loader-DMU7MElH.js";import{S as G}from"./square-check-big-DlVo-rQ2.js";import{C as W}from"./clock-04BLIM7u.js";import{M as he}from"./map-pin-BUW29wY0.js";import{L as ie}from"./loader-circle-ZVWRwCK0.js";import{C as Me}from"./circle-check-KVYfCMLA.js";import{L as Ie}from"./log-out-C9kJv6u3.js";import{C as M}from"./circle-x-YOFRGHgJ.js";import{T as Be}from"./trending-up-e0U5eMl_.js";import{C as H}from"./circle-check-big-DhNyGKn9.js";import{W as $e}from"./wallet-wCGWKG4-.js";import{S as We}from"./square-CdDjSuHm.js";import"./Footer-CWCGcQgO.js";/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],ue=Se("camera",Ue);function Qe({bookings:m,onViewChecklist:d}){const[t,a]=w.useState(new Date),n=r=>new Date(r.getFullYear(),r.getMonth(),1),N=r=>new Date(r.getFullYear(),r.getMonth()+1,0),o=r=>{const h=n(r),i=N(r),x=[],D=h.getDay();for(let f=D-1;f>=0;f--){const v=new Date(h);v.setDate(v.getDate()-f-1),x.push(v)}for(let f=1;f<=i.getDate();f++)x.push(new Date(r.getFullYear(),r.getMonth(),f));const b=42-x.length;for(let f=1;f<=b;f++){const v=new Date(i);v.setDate(v.getDate()+f),x.push(v)}return x},j=r=>{const h=r.getFullYear(),i=r.getMonth(),x=r.getDate();return m.filter(D=>{const b=new Date(D.scheduledDate);return b.getFullYear()===h&&b.getMonth()===i&&b.getDate()===x})},l=()=>{a(new Date(t.getFullYear(),t.getMonth()-1,1))},g=()=>{a(new Date(t.getFullYear(),t.getMonth()+1,1))},C=r=>{const h=new Date;return r.getDate()===h.getDate()&&r.getMonth()===h.getMonth()&&r.getFullYear()===h.getFullYear()},F=r=>r.getMonth()===t.getMonth(),E=o(t),R=t.toLocaleDateString("en-US",{month:"long"}),u=t.getFullYear();return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"bg-gradient-to-r from-primary to-primary-dark text-white p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-white/20 backdrop-blur-sm rounded-lg flex items-center justify-center",children:e.jsx($,{className:"w-6 h-6"})}),e.jsxs("h2",{className:"text-2xl font-bold",children:[R," ",u]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:l,className:"p-2 bg-white/10 backdrop-blur-sm rounded-lg hover:bg-white/20 transition-colors",children:e.jsx(Pe,{className:"w-5 h-5"})}),e.jsx("button",{onClick:g,className:"p-2 bg-white/10 backdrop-blur-sm rounded-lg hover:bg-white/20 transition-colors",children:e.jsx(Le,{className:"w-5 h-5"})})]})]})}),e.jsxs("div",{className:"p-4",children:[e.jsx("div",{className:"grid grid-cols-7 gap-2 mb-2",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(r=>e.jsx("div",{className:"text-center text-sm font-semibold text-gray-600 py-2",children:r},r))}),e.jsx("div",{className:"grid grid-cols-7 gap-2",children:E.map((r,h)=>{const i=j(r),x=F(r),D=C(r);return e.jsxs("div",{className:`min-h-[120px] border rounded-lg p-2 ${x?"bg-white border-gray-200":"bg-gray-50 border-gray-100"} ${D?"ring-2 ring-primary":""}`,children:[e.jsx("div",{className:`text-sm font-semibold mb-2 ${x?"text-gray-900":"text-gray-400"} ${D?"text-primary":""}`,children:r.getDate()}),e.jsx("div",{className:"space-y-1",children:i.map(b=>{const f=b.checklist,v=f?.items.filter(k=>k.isCompleted).length||0,A=f?.items.length||0,L=f&&A>0;return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"w-full text-left text-xs p-1.5 rounded border bg-primary/10 border-primary/30 hover:bg-primary/20 transition-colors",children:[e.jsx("div",{className:"font-semibold truncate text-gray-900",children:B(b.scheduledTime)}),e.jsx("div",{className:"truncate text-gray-700",children:b.serviceType}),e.jsxs("div",{className:"truncate text-gray-600 text-[10px] mt-0.5",children:[b.client.firstName," ",b.client.lastName]})]}),L&&d&&e.jsxs("button",{onClick:k=>{k.stopPropagation(),d(b.id)},className:"absolute top-1 right-1 flex items-center gap-0.5 px-1.5 py-0.5 bg-primary/90 text-white rounded text-[10px] font-semibold hover:bg-primary transition-colors",title:"View checklist",children:[e.jsx(G,{className:"w-2.5 h-2.5"}),v,"/",A]})]},b.id)})})]},h)})})]})]})}function Ke({activeBookings:m}){const d=z(),t=Z(),a=ne(i=>i.user),[n,N]=w.useState({}),[o,j]=w.useState(""),l=P({...d.time.getTimeEntries.queryOptions({userId:a?.id??0}),enabled:!!a?.id}),g=w.useMemo(()=>l.data?.find(i=>!i.endTime),[l.data]),[C,F]=w.useState(g?.bookingId),E=q(d.time.punchIn.mutationOptions({onSuccess:()=>{y.success("Punched in"),t.invalidateQueries({queryKey:d.time.getTimeEntries.queryKey()})},onError:i=>y.error(i.message||"Failed to punch in")})),R=q(d.time.punchOut.mutationOptions({onSuccess:()=>{y.success("Punched out"),t.invalidateQueries({queryKey:d.time.getTimeEntries.queryKey()})},onError:i=>y.error(i.message||"Failed to punch out")})),u=()=>new Promise(i=>{if(!navigator.geolocation)return i({});navigator.geolocation.getCurrentPosition(x=>i({lat:x.coords.latitude,lng:x.coords.longitude}),()=>i({}),{enableHighAccuracy:!0,timeout:5e3})}),r=async()=>{if(!a?.id){y.error("Missing user session");return}const i=await u();N(i),g?R.mutate({userId:a.id,lat:i.lat,lng:i.lng,locationNote:o}):E.mutate({userId:a.id,bookingId:C,lat:i.lat,lng:i.lng,locationNote:o})},h=l.isLoading||E.isPending||R.isPending;return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx(W,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Time Tracking"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:g?"Currently punched in":"Currently punched out"}),l.isError&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:"Failed to load time entries"})]}),e.jsx("button",{onClick:r,disabled:h,className:`px-4 py-2 rounded-lg font-semibold transition-colors ${g?"bg-red-100 text-red-700 hover:bg-red-200":"bg-primary text-white hover:bg-primary-dark"} ${h?"opacity-70 cursor-not-allowed":""}`,children:g?"Punch Out":"Punch In"})]}),m&&m.length>0&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700",children:[e.jsx("span",{className:"text-gray-600",children:"Booking:"}),e.jsxs("select",{value:C??"",onChange:i=>F(i.target.value?Number(i.target.value):void 0),className:"border border-gray-200 rounded-lg px-3 py-2 text-sm flex-1",children:[e.jsx("option",{value:"",children:"None"}),m.map(i=>e.jsx("option",{value:i.id,children:i.label},i.id))]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700",children:[e.jsx(he,{className:"w-4 h-4 text-primary"}),e.jsx("input",{type:"text",value:o,onChange:i=>j(i.target.value),placeholder:"Optional location note (e.g., front door, lobby)",className:"flex-1 border border-gray-200 rounded-lg px-3 py-2 text-sm"})]})]})}function Ye({bookingId:m,uploaderId:d}){const t=z(),a=Z(),[n,N]=w.useState(null),o=P(t.photos.getBookingImages.queryOptions({bookingId:m})),j=q(t.photos.createSignedUpload.mutationOptions()),l=q(t.photos.savePhotoRecord.mutationOptions()),g=async(u,r)=>{const h=u.target.files;if(!h||h.length===0)return;N(r);const i=Array.from(h);for(const x of i)try{const D=await j.mutateAsync({bookingId:m,fileName:x.name,contentType:x.type});if(!(await fetch(D.signedUrl,{method:"PUT",body:x,headers:{"Content-Type":x.type}})).ok)throw new Error("Upload failed");await l.mutateAsync({bookingId:m,uploaderId:d,path:D.path,imageType:r,contentType:x.type}),y.success(`${r.charAt(0)+r.slice(1).toLowerCase()} photo uploaded`)}catch(D){console.error(D),y.error(D?.message||"Upload failed")}N(null),u.target.value="",a.invalidateQueries({queryKey:t.photos.getBookingImages.queryKey({bookingId:m})})},C=o.data||[],F=C.filter(u=>u.imageType==="BEFORE"),E=C.filter(u=>u.imageType==="DURING"),R=C.filter(u=>u.imageType==="AFTER");return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"relative group",children:[e.jsx("input",{type:"file",accept:"image/*",multiple:!0,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10",onChange:u=>g(u,"BEFORE"),disabled:n!==null}),e.jsxs("div",{className:`p-4 rounded-xl border-2 border-dashed transition-all flex flex-col items-center justify-center gap-2 ${n==="BEFORE"?"bg-blue-50 border-blue-400":"bg-gray-50 border-gray-200 group-hover:bg-blue-50 group-hover:border-blue-400"}`,children:[n==="BEFORE"?e.jsx(ie,{className:"w-6 h-6 text-blue-500 animate-spin"}):e.jsx(ue,{className:"w-6 h-6 text-blue-500"}),e.jsx("span",{className:"text-sm font-semibold text-blue-700",children:"Add Before Photos"}),e.jsx("span",{className:"text-[10px] text-gray-500",children:"Show the starting point"})]})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("input",{type:"file",accept:"image/*",multiple:!0,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10",onChange:u=>g(u,"AFTER"),disabled:n!==null}),e.jsxs("div",{className:`p-4 rounded-xl border-2 border-dashed transition-all flex flex-col items-center justify-center gap-2 ${n==="AFTER"?"bg-green-50 border-green-400":"bg-gray-50 border-gray-200 group-hover:bg-green-50 group-hover:border-green-400"}`,children:[n==="AFTER"?e.jsx(ie,{className:"w-6 h-6 text-green-500 animate-spin"}):e.jsx(Me,{className:"w-6 h-6 text-green-500"}),e.jsx("span",{className:"text-sm font-semibold text-green-700",children:"Add After Photos"}),e.jsx("span",{className:"text-[10px] text-gray-500",children:"Show the transformation"})]})]})]}),e.jsxs("div",{className:"space-y-8",children:[e.jsx(V,{title:"Before",images:F,isLoading:o.isLoading}),e.jsx(V,{title:"After",images:R,isLoading:o.isLoading}),E.length>0&&e.jsx(V,{title:"Work in Progress",images:E,isLoading:o.isLoading})]})]})}function V({title:m,images:d,isLoading:t}){return d.length===0&&!t?null:e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-sm font-bold text-gray-900 border-l-4 border-primary pl-2 uppercase tracking-wider",children:m}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:t?[1,2,3].map(a=>e.jsx("div",{className:"aspect-square rounded-xl bg-gray-100 animate-pulse"},a)):d.map(a=>e.jsxs("div",{className:"relative aspect-square rounded-xl overflow-hidden border border-gray-200 shadow-sm group",children:[e.jsx("img",{src:a.signedUrl,alt:a.caption||m,className:"w-full h-full object-cover transition-transform duration-300 group-hover:scale-110"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/50 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity flex items-end p-2",children:e.jsx("span",{className:"text-[10px] text-white font-medium",children:a.caption||m})})]},a.id))})]})}const le=m=>{const[d,t,a]=(m||"").split("-").map(Number);return new Date(d||0,(t||1)-1,a||1)};function He({request:m,onClose:d,onSubmit:t,isSubmitting:a}){const n=de({startDate:I().min(1,"Start date is required"),endDate:I().min(1,"End date is required"),reason:I().optional()}).refine(l=>{const g=new Date(l.startDate);return new Date(l.endDate)>=g},{message:"End date must be on or after start date",path:["endDate"]}),{register:N,handleSubmit:o,formState:{errors:j}}=ce({resolver:me(n),defaultValues:{startDate:m.startDate,endDate:m.endDate,reason:m.reason||""}});return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[1001] p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-lg w-full",children:[e.jsx("div",{className:"bg-gradient-to-r from-primary to-primary-dark text-white p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Edit Time-Off Request"}),e.jsx("button",{onClick:d,className:"p-2 hover:bg-white/10 rounded-lg transition-colors",children:e.jsx(M,{className:"w-6 h-6"})})]})}),e.jsxs("form",{onSubmit:o(t),className:"p-6 space-y-4",children:[e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-startDate",className:"mb-1 block text-sm font-medium text-gray-700",children:"Start Date *"}),e.jsx("input",{id:"edit-startDate",type:"date",...N("startDate"),className:"w-full rounded-md border border-[#d7d1c4] bg-[#f7f4ed] text-[#163022] px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent placeholder:text-gray-500"}),j.startDate&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:j.startDate.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-endDate",className:"mb-1 block text-sm font-medium text-gray-700",children:"End Date *"}),e.jsx("input",{id:"edit-endDate",type:"date",...N("endDate"),className:"w-full rounded-md border border-[#d7d1c4] bg-[#f7f4ed] text-[#163022] px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent placeholder:text-gray-500"}),j.endDate&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:j.endDate.message})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"edit-reason",className:"mb-1 block text-sm font-medium text-gray-700",children:"Reason (Optional)"}),e.jsx("textarea",{id:"edit-reason",rows:3,...N("reason"),className:"w-full rounded-md border border-[#d7d1c4] bg-[#f7f4ed] text-[#163022] px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent placeholder:text-gray-500",placeholder:"Provide a reason for your time-off request..."})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:d,className:"flex-1 px-4 py-2.5 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors font-medium",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:a,className:"flex-1 flex items-center justify-center gap-2 rounded-lg bg-primary py-2.5 text-sm font-semibold text-white hover:bg-primary-dark disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors",children:a?e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"w-4 h-4 animate-spin"}),"Updating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"w-4 h-4"}),"Update Request"]})})]})]})]})})}function Ve({booking:m,onClose:d,onToggleItem:t,isUpdating:a}){if(!m||!m.checklist)return null;const n=m.checklist,N=n.items.filter(l=>l.isCompleted).length,o=n.items.length,j=o>0?Math.round(N/o*100):0;return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-[1001] p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"bg-gradient-to-r from-primary to-primary-dark text-white p-6 sticky top-0 z-10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-2xl font-bold mb-1",children:n.template.name}),e.jsx("p",{className:"text-green-100 text-sm",children:m.serviceType})]}),e.jsx("button",{onClick:d,className:"p-2 hover:bg-white/10 rounded-lg transition-colors",children:e.jsx(M,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"font-medium",children:"Progress"}),e.jsxs("span",{className:"font-bold",children:[N," / ",o," (",j,"%)"]})]}),e.jsx("div",{className:"w-full bg-white/20 rounded-full h-3 overflow-hidden",children:e.jsx("div",{className:"bg-white h-full rounded-full transition-all duration-500 ease-out",style:{width:`${j}%`}})})]})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"space-y-3",children:n.items.map((l,g)=>e.jsxs("button",{onClick:()=>t(l.id,l.isCompleted),disabled:a,className:`w-full flex items-start gap-4 p-4 rounded-lg border-2 transition-all duration-200 text-left ${l.isCompleted?"bg-green-50 border-green-200 hover:bg-green-100":"bg-white border-gray-200 hover:bg-gray-50 hover:border-primary/30"} ${a?"opacity-50 cursor-not-allowed":"cursor-pointer"}`,children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:l.isCompleted?e.jsx(G,{className:"w-6 h-6 text-green-600"}):e.jsx(We,{className:"w-6 h-6 text-gray-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsx("p",{className:`text-sm font-medium ${l.isCompleted?"text-green-900 line-through":"text-gray-900"}`,children:l.description}),e.jsxs("span",{className:"text-xs font-semibold text-gray-400 flex-shrink-0",children:["#",g+1]})]}),l.isCompleted&&l.completedAt&&e.jsxs("p",{className:"text-xs text-green-700 mt-1",children:["Completed ",new Date(l.completedAt).toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit"})]})]})]},l.id))}),e.jsx("div",{className:"mt-6 pt-6 border-t border-gray-200",children:e.jsx("button",{onClick:d,className:"w-full px-6 py-3 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors font-medium",children:"Close Checklist"})})]})]})})}function ze({onSubmit:m,isSubmitting:d}){const t=de({startDate:I().min(1,"Start date is required"),endDate:I().min(1,"End date is required"),reason:I().optional()}).refine(l=>{const g=new Date(l.startDate);return new Date(l.endDate)>=g},{message:"End date must be on or after start date",path:["endDate"]}),{register:a,handleSubmit:n,reset:N,formState:{errors:o}}=ce({resolver:me(t)}),j=l=>{m(l),N()};return e.jsxs("form",{onSubmit:n(j),className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"startDate",className:"mb-1 block text-sm font-medium text-gray-700",children:"Start Date *"}),e.jsx("input",{id:"startDate",type:"date",...a("startDate"),className:"w-full rounded-md border border-[#d7d1c4] bg-[#f7f4ed] text-[#163022] px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent placeholder:text-gray-500"}),o.startDate&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.startDate.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"endDate",className:"mb-1 block text-sm font-medium text-gray-700",children:"End Date *"}),e.jsx("input",{id:"endDate",type:"date",...a("endDate"),className:"w-full rounded-md border border-[#d7d1c4] bg-[#f7f4ed] text-[#163022] px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent placeholder:text-gray-500"}),o.endDate&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:o.endDate.message})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"reason",className:"mb-1 block text-sm font-medium text-gray-700",children:"Reason (Optional)"}),e.jsx("textarea",{id:"reason",rows:3,...a("reason"),className:"w-full rounded-md border border-[#d7d1c4] bg-[#f7f4ed] text-[#163022] px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent placeholder:text-gray-500",placeholder:"Provide a reason for your time-off request..."})]}),e.jsx("button",{type:"submit",disabled:d,className:"w-full flex items-center justify-center gap-2 rounded-md bg-primary py-2.5 text-sm font-semibold text-white hover:bg-primary-dark disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors",children:d?e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"w-4 h-4 animate-spin"}),"Submitting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"w-4 h-4"}),"Submit Request"]})})]})}const hs=function(){const d=Ee(),t=z(),{token:a,user:n,clearAuth:N}=ne(),{view:o}=Ae.useSearch(),[j,l]=w.useState(),g=Z(),[C,F]=w.useState(""),[E,R]=w.useState(""),[u,r]=w.useState(void 0),[h,i]=w.useState(void 0),[x,D]=w.useState(null),[b,f]=w.useState(null);w.useEffect(()=>{if(!a||!n){y.error("Please log in to access the cleaner portal"),Promise.resolve().then(()=>{d({to:"/login"})});return}n.role!=="CLEANER"&&(y.error("Access denied. Cleaner account required."),Promise.resolve().then(()=>{d({to:"/"})}))},[a,n,d]);const v=P(t.getSchedule.queryOptions(void 0,{enabled:!!a})),A=P(t.getPayments.queryOptions({startDate:u,endDate:h},{enabled:!!a})),L=P(t.getTimeOffRequests.queryOptions(void 0,{enabled:!!a})),k=P(t.availability.getCleanerAvailability.queryOptions({cleanerId:n?.id??0},{enabled:!!(a&&n?.id)})),J=P(t.time.getTimeEntries.queryOptions({bookingId:x?.id??0},{enabled:!!(a&&x?.id)})),U=q(t.availability.setCleanerAvailability.mutationOptions({onSuccess:()=>{y.success("Availability saved"),g.invalidateQueries({queryKey:t.availability.getCleanerAvailability.queryKey()})},onError:s=>y.error(s.message||"Failed to save availability")})),_=[{dayOfWeek:1,label:"Monday",startTime:"07:30",endTime:"17:00",isAvailable:!0},{dayOfWeek:2,label:"Tuesday",startTime:"07:30",endTime:"17:00",isAvailable:!0},{dayOfWeek:3,label:"Wednesday",startTime:"07:30",endTime:"17:00",isAvailable:!0},{dayOfWeek:4,label:"Thursday",startTime:"07:30",endTime:"17:00",isAvailable:!0},{dayOfWeek:5,label:"Friday",startTime:"07:30",endTime:"17:00",isAvailable:!0},{dayOfWeek:6,label:"Saturday",startTime:"08:00",endTime:"14:00",isAvailable:!1},{dayOfWeek:0,label:"Sunday",startTime:"08:00",endTime:"14:00",isAvailable:!1}],[Q,K]=w.useState(_);w.useEffect(()=>{if(k.data){const s=_.map(c=>{const p=k.data.find(T=>T.dayOfWeek===c.dayOfWeek);return p?{dayOfWeek:p.dayOfWeek,label:c.label,startTime:p.startTime,endTime:p.endTime,isAvailable:p.isAvailable}:c});K(s)}},[k.data]);const Y=(s,c,p)=>{K(T=>{const O=[...T];return O[s]&&(c==="startTime"||c==="endTime"?O[s]={...O[s],[c]:p}:O[s]={...O[s],[c]:p}),O})},ge=s=>{const c=Q[s];c&&K(p=>p.map((T,O)=>O===s?T:{...T,startTime:c.startTime||"08:00",endTime:c.endTime||"17:00",isAvailable:!!c.isAvailable}))},pe=()=>{n?.id&&U.mutate({cleanerId:n.id,availability:Q.map(({dayOfWeek:s,startTime:c,endTime:p,isAvailable:T})=>({dayOfWeek:s,startTime:c,endTime:p,isAvailable:T}))})},X=q(t.submitTimeOffRequest.mutationOptions({onSuccess:()=>{y.success("Time-off request submitted successfully!"),g.invalidateQueries({queryKey:t.getTimeOffRequests.queryKey()})},onError:s=>{y.error(s.message||"Failed to submit request")}})),ye=q(t.deleteTimeOffRequest.mutationOptions({onSuccess:()=>{y.success("Request canceled successfully!"),g.invalidateQueries({queryKey:t.getTimeOffRequests.queryKey()})},onError:s=>{y.error(s.message||"Failed to cancel request")}})),ee=q(t.updateTimeOffRequest.mutationOptions({onSuccess:()=>{y.success("Request updated successfully!"),g.invalidateQueries({queryKey:t.getTimeOffRequests.queryKey()}),f(null)},onError:s=>{y.error(s.message||"Failed to update request")}})),se=q(t.updateBookingChecklistItem.mutationOptions({onSuccess:()=>{y.success("Checklist updated!"),g.invalidateQueries({queryKey:t.getSchedule.queryKey()})},onError:s=>{y.error(s.message||"Failed to update checklist")}})),be=(s,c)=>{se.mutate({itemId:s,isCompleted:!c})},te=s=>{l(s)},fe=()=>{l(void 0)},je=()=>{r(C||void 0),i(E||void 0)},Ne=()=>{F(""),R(""),r(void 0),i(void 0)},ve=s=>{confirm("Are you sure you want to cancel this request?")&&ye.mutate({requestId:s})},we=s=>{const c=new Date(s.startDate).toISOString().split("T")[0],p=new Date(s.endDate).toISOString().split("T")[0];f({id:s.id,startDate:c??"",endDate:p??"",reason:s.reason||""})},De=s=>{b&&ee.mutate({requestId:b.id,startDate:`${s.startDate}T12:00:00.000Z`,endDate:`${s.endDate}T12:00:00.000Z`,reason:s.reason})},Ce=()=>{N(),y.success("Logged out successfully"),d({to:"/login"})},ke=s=>s?{CREDIT_CARD:"Credit Card",CASH:"Cash",ZELLE:"Zelle",VENMO:"Venmo",OTHER:"Other"}[s]||s:"N/A";return!a||!n?null:e.jsxs(Re,{portalType:"cleaner",children:[e.jsxs("div",{className:"bg-[#edeae1] min-h-screen",children:[e.jsx("div",{className:"bg-gradient-to-r from-primary to-primary-dark text-white shadow-lg",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl sm:text-4xl font-bold font-heading",children:"Welcome Back! ðŸ‘‹"}),e.jsx("p",{className:"mt-2 text-green-100 text-base",children:n.firstName||n.email})]}),e.jsxs("button",{onClick:Ce,className:"flex items-center justify-center gap-2 px-5 py-2.5 bg-white/10 backdrop-blur-sm text-white rounded-lg hover:bg-white/20 transition-all duration-200 border border-white/20 shadow-lg hover:shadow-xl self-start sm:self-center",children:[e.jsx(Ie,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"Logout"})]})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-8",children:[e.jsx("div",{className:"grid grid-cols-1",children:e.jsx(Ke,{activeBookings:v.data?.bookings?.map(s=>({id:s.id,label:`${s.serviceType} â€¢ ${S(s.scheduledDate)} ${B(s.scheduledTime)}`}))})}),(o==="dashboard"||o==="schedule")&&e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center",children:e.jsx($,{className:"w-6 h-6 text-primary"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 font-heading",children:"My Schedule"})]}),v.isLoading?e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-12 text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-primary border-t-transparent"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"Loading your schedule..."})]})}):v.isError?e.jsx("div",{className:"bg-red-50 rounded-xl shadow-sm border border-red-200 p-12 text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx(M,{className:"w-8 h-8 text-red-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-red-900 font-semibold text-lg mb-1",children:"Error Loading Schedule"}),e.jsx("p",{className:"text-red-700 text-sm",children:"Please try refreshing the page"})]})]})}):v.data?.bookings.length===0?e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-12 text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center",children:e.jsx($,{className:"w-10 h-10 text-gray-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-900 font-semibold text-lg mb-1",children:"No Bookings Scheduled"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"You don't have any cleaning appointments yet"})]})]})}):o==="schedule"?e.jsx(Qe,{bookings:v.data?.bookings||[],onViewChecklist:te}):e.jsx("div",{className:"grid gap-6 md:grid-cols-2 xl:grid-cols-3",children:v.data?.bookings.map(s=>{const c=s.checklist,p=c?.items.filter(Te=>Te.isCompleted).length||0,T=c?.items.length||0,O=c&&T>0;return e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 hover:shadow-lg hover:border-primary/20 transition-all duration-300 overflow-hidden group",children:[e.jsx("div",{className:"bg-gradient-to-r from-gray-50 to-white p-4 border-b border-gray-100",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"flex-1"}),O&&e.jsxs("button",{onClick:()=>te(s.id),className:"flex items-center gap-1.5 px-3 py-1.5 bg-primary/10 text-primary rounded-lg hover:bg-primary/20 transition-colors text-xs font-semibold",children:[e.jsx(G,{className:"w-3.5 h-3.5"}),p,"/",T]})]})}),e.jsxs("div",{className:"p-5",children:[e.jsx("h3",{className:"font-bold text-lg mb-4 text-gray-900 font-heading group-hover:text-primary transition-colors",children:s.serviceType}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx($,{className:"w-4 h-4 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-gray-500 text-xs mb-0.5",children:"Date"}),e.jsx("p",{className:"text-gray-900 font-medium",children:S(s.scheduledDate,{weekday:"short",month:"short",day:"numeric",year:"numeric"})})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(W,{className:"w-4 h-4 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-gray-500 text-xs mb-0.5",children:"Time"}),e.jsx("p",{className:"text-gray-900 font-medium",children:B(s.scheduledTime)}),s.durationHours!==null&&e.jsxs("p",{className:"text-gray-600 text-xs mt-1",children:["Duration: ",Fe(s.durationHours/Math.max(1,s.numberOfCleanersRequested||1)),s.numberOfCleanersRequested&&s.numberOfCleanersRequested>1?` â€¢ ${s.numberOfCleanersRequested} cleaners`:""]})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(he,{className:"w-4 h-4 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-gray-500 text-xs mb-0.5",children:"Location"}),e.jsx("p",{className:"text-gray-900 font-medium line-clamp-2",children:s.address}),e.jsxs("p",{className:"text-gray-500 text-xs mt-1",children:["Payment: ",ke(s.paymentMethod)]})]})]}),e.jsx("div",{className:"pt-3 border-t border-gray-100",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-primary/10 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(Oe,{className:"w-4 h-4 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-gray-500 text-xs mb-0.5",children:"Client"}),e.jsxs("p",{className:"text-gray-900 font-medium",children:[s.client.firstName," ",s.client.lastName]}),s.client.phone&&e.jsxs("a",{href:`tel:${s.client.phone}`,className:"text-primary hover:text-primary-dark text-xs mt-1 inline-block",children:["ðŸ“ž ",s.client.phone]})]})]})})]})]}),s.specialInstructions&&e.jsx("div",{className:"px-5 pb-5",children:e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 border border-gray-200",children:[e.jsx("p",{className:"text-xs text-gray-600 font-semibold mb-1.5",children:"Special Instructions"}),e.jsx("p",{className:"text-xs text-gray-700 leading-relaxed",children:s.specialInstructions})]})}),e.jsx("div",{className:"px-5 pb-5",children:e.jsx("button",{onClick:()=>D(s),className:"w-full mt-2 px-4 py-2 text-sm font-semibold bg-primary text-white rounded-lg hover:bg-primary-dark transition",children:"View Details"})})]},s.id)})})]}),o==="payments"&&e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx(qe,{className:"w-6 h-6 text-green-600"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 font-heading",children:"Payments"})]}),A.isLoading?e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-12 text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-primary border-t-transparent"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"Loading payment information..."})]})}):A.isError?e.jsx("div",{className:"bg-red-50 rounded-xl shadow-sm border border-red-200 p-12 text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx(M,{className:"w-8 h-8 text-red-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-red-900 font-semibold text-lg mb-1",children:"Error Loading Payments"}),e.jsx("p",{className:"text-red-700 text-sm",children:"Please try refreshing the page"})]})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Filter Payment Period"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-end",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{htmlFor:"startDate",className:"block text-sm font-medium text-gray-700 mb-2",children:"Start Date"}),e.jsx("input",{type:"date",id:"startDate",value:C,onChange:s=>F(s.target.value),className:"w-full px-4 py-2 border border-[#d7d1c4] rounded-lg focus:ring-2 focus:ring-primary focus:border-[#163022] bg-[#f7f4ed] text-[#163022]"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{htmlFor:"endDate",className:"block text-sm font-medium text-gray-700 mb-2",children:"End Date"}),e.jsx("input",{type:"date",id:"endDate",value:E,onChange:s=>R(s.target.value),className:"w-full px-4 py-2 border border-[#d7d1c4] rounded-lg focus:ring-2 focus:ring-primary focus:border-[#163022] bg-[#f7f4ed] text-[#163022]"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:je,className:"px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors font-medium shadow-sm hover:shadow-md",children:"Apply"}),(u||h)&&e.jsx("button",{onClick:Ne,className:"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors font-medium",children:"Clear"})]})]}),(u||h)&&e.jsxs("div",{className:"mt-3 text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Active Filter:"})," ",u&&e.jsxs("span",{children:["From ",S(le(u))]}),u&&h&&e.jsx("span",{children:" "}),h&&e.jsxs("span",{children:["To ",S(le(h))]})]})]}),e.jsxs("div",{className:"grid gap-5 sm:grid-cols-2 lg:grid-cols-3 mb-8",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary to-primary-dark rounded-xl shadow-lg p-6 text-white",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsx("div",{className:"w-12 h-12 bg-white/20 backdrop-blur-sm rounded-lg flex items-center justify-center",children:e.jsx(Be,{className:"w-6 h-6"})})}),e.jsx("p",{className:"text-green-100 text-sm mb-2 font-medium",children:"Total Earnings"}),e.jsxs("p",{className:"text-4xl font-bold",children:["$",A.data?.summary.totalEarnings.toFixed(2)]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border-2 border-green-200 p-6",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsx("div",{className:"w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx(H,{className:"w-6 h-6 text-green-600"})})}),e.jsx("p",{className:"text-gray-600 text-sm mb-2 font-medium",children:"Paid"}),e.jsxs("p",{className:"text-4xl font-bold text-green-600",children:["$",A.data?.summary.paidEarnings.toFixed(2)]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border-2 border-yellow-200 p-6",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsx("div",{className:"w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center",children:e.jsx(ae,{className:"w-6 h-6 text-yellow-600"})})}),e.jsx("p",{className:"text-gray-600 text-sm mb-2 font-medium",children:"Pending"}),e.jsxs("p",{className:"text-4xl font-bold text-yellow-600",children:["$",A.data?.summary.pendingEarnings.toFixed(2)]})]})]}),A.data?.payments.length===0?e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-12 text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center",children:e.jsx($e,{className:"w-10 h-10 text-gray-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-900 font-semibold text-lg mb-1",children:"No Payment History"}),e.jsx("p",{className:"text-gray-600 text-sm",children:u||h?"No payments found for the selected period. Try clearing the filter to see all payments.":"Your payment history will appear here once you complete jobs"})]})]})}):e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 bg-gradient-to-r from-gray-50 to-white border-b border-gray-200",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900 font-heading",children:"Payment History"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Date"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Service"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Amount"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-700 uppercase tracking-wider",children:"Status"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:A.data?.payments.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 font-medium",children:S(s.createdAt,{month:"short",day:"numeric",year:"numeric"})}),e.jsxs("td",{className:"px-6 py-4 text-sm",children:[e.jsx("div",{className:"font-medium text-gray-900",children:s.booking.serviceType}),e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:S(s.booking.scheduledDate,{month:"short",day:"numeric"})})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-bold text-gray-900",children:["$",s.amount.toFixed(2)]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex items-center gap-1.5 px-3 py-1 text-xs font-semibold rounded-full ${s.paidAt?"bg-green-100 text-green-800 border border-green-200":"bg-yellow-100 text-yellow-800 border border-yellow-200"}`,children:s.paidAt?e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"w-3 h-3"}),"Paid"]}):e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"w-3 h-3"}),"Pending"]})})})]},s.id))})]})})]})]})]}),o==="requests"&&e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center",children:e.jsx(re,{className:"w-6 h-6 text-purple-600"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 font-heading",children:"Schedule Change Requests"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Submit New Request"}),e.jsx(ze,{onSubmit:s=>{X.mutate({startDate:`${s.startDate}T12:00:00.000Z`,endDate:`${s.endDate}T12:00:00.000Z`,reason:s.reason})},isSubmitting:X.isPending})]}),L.isLoading?e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-12 text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-primary border-t-transparent"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"Loading your requests..."})]})}):L.isError?e.jsx("div",{className:"bg-red-50 rounded-xl shadow-sm border border-red-200 p-12 text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center",children:e.jsx(M,{className:"w-8 h-8 text-red-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-red-900 font-semibold text-lg mb-1",children:"Error Loading Requests"}),e.jsx("p",{className:"text-red-700 text-sm",children:"Please try refreshing the page"})]})]})}):L.data?.requests.length===0?e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-12 text-center",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center",children:e.jsx(re,{className:"w-10 h-10 text-gray-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-900 font-semibold text-lg mb-1",children:"No Requests Yet"}),e.jsx("p",{className:"text-gray-600 text-sm",children:"Submit a request above to change your schedule or availability"})]})]})}):e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 bg-gradient-to-r from-gray-50 to-white border-b border-gray-200",children:e.jsx("h3",{className:"text-lg font-semibold text-gray-900 font-heading",children:"Your Requests"})}),e.jsx("div",{className:"divide-y divide-gray-200",children:(L.data?.requests||[]).map(s=>e.jsx("div",{className:"p-6 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("span",{className:`inline-flex items-center gap-1.5 px-3 py-1 text-xs font-semibold rounded-full ${s.status==="APPROVED"?"bg-green-100 text-green-800 border border-green-200":s.status==="REJECTED"?"bg-red-100 text-red-800 border border-red-200":"bg-yellow-100 text-yellow-800 border border-yellow-200"}`,children:s.status==="APPROVED"?e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"w-3 h-3"}),"Approved"]}):s.status==="REJECTED"?e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"w-3 h-3"}),"Rejected"]}):e.jsxs(e.Fragment,{children:[e.jsx(W,{className:"w-3 h-3"}),"Pending"]})}),e.jsxs("span",{className:"text-xs text-gray-500",children:["Submitted ",S(s.createdAt,{month:"short",day:"numeric",year:"numeric"})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:[S(s.startDate,{weekday:"short",month:"short",day:"numeric",year:"numeric"})," â†’ ",S(s.endDate,{weekday:"short",month:"short",day:"numeric",year:"numeric"})]}),s.reason&&e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Reason:"})," ",s.reason]}),s.reviewedBy&&e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["Reviewed by ",s.reviewedBy.firstName," ",s.reviewedBy.lastName,s.reviewedAt&&e.jsxs(e.Fragment,{children:[" on ",S(s.reviewedAt,{month:"short",day:"numeric",year:"numeric"})]})]}),s.adminNotes&&e.jsxs("p",{className:"text-sm text-gray-700 mt-2 p-3 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsx("span",{className:"font-medium",children:"Admin Notes:"})," ",s.adminNotes]})]})]}),s.status==="PENDING"&&e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("button",{onClick:()=>we(s),className:"px-3 py-1.5 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors text-xs font-semibold",children:"Edit"}),e.jsx("button",{onClick:()=>ve(s.id),className:"px-3 py-1.5 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition-colors text-xs font-semibold",children:"Cancel"})]})]})},s.id))})]})]}),(o==="dashboard"||o==="requests")&&e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center",children:e.jsx(W,{className:"w-6 h-6 text-green-700"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 font-heading",children:"Availability & Working Hours"})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 p-6 space-y-4",children:[k.data&&k.data.length>0&&n?.role==="CLEANER"&&e.jsx("div",{className:"p-3 rounded-lg border border-amber-200 bg-amber-50 text-amber-800 text-sm",children:"Availability changes require admin approval after initial setup. Contact admin if you need updates."}),e.jsx("p",{className:"text-sm text-gray-600",children:"Set your weekly working hours. Use â€œCopy to all daysâ€ to quickly duplicate settings."}),e.jsx("div",{className:"space-y-3",children:Q.map((s,c)=>e.jsxs("div",{className:"border border-gray-100 rounded-lg p-3 flex flex-col sm:flex-row sm:items-center sm:gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx("label",{className:"text-sm font-semibold text-gray-800 w-24",children:s.label}),e.jsx("input",{type:"time",value:s.startTime,onChange:p=>Y(c,"startTime",p.target.value),className:"px-3 py-2 border border-[#d7d1c4] rounded-lg text-sm bg-[#f7f4ed] text-[#163022]",disabled:!s.isAvailable||k.isLoading}),e.jsx("span",{className:"text-xs text-gray-500",children:"to"}),e.jsx("input",{type:"time",value:s.endTime,onChange:p=>Y(c,"endTime",p.target.value),className:"px-3 py-2 border border-[#d7d1c4] rounded-lg text-sm bg-[#f7f4ed] text-[#163022]",disabled:!s.isAvailable||k.isLoading}),e.jsxs("label",{className:"inline-flex items-center gap-2 text-sm text-gray-700 ml-2",children:[e.jsx("input",{type:"checkbox",checked:s.isAvailable,onChange:p=>Y(c,"isAvailable",p.target.checked),className:"h-4 w-4 rounded border-[#d7d1c4] text-primary",disabled:k.isLoading}),"Available"]})]}),e.jsx("div",{className:"mt-2 sm:mt-0",children:e.jsx("button",{type:"button",className:"px-3 py-2 text-xs font-semibold rounded-lg border border-gray-200 text-gray-700 hover:bg-gray-50",onClick:()=>ge(c),children:"Copy to all days"})})]},s.dayOfWeek))}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:pe,className:"px-4 py-2 rounded-lg bg-primary text-white font-semibold hover:bg-primary-dark disabled:opacity-50",disabled:U.isPending||k.isLoading,children:U.isPending?"Saving...":"Save Availability"})})]})]})]})]}),x&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-[1100] flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-y-auto p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900",children:x.serviceType}),e.jsxs("p",{className:"text-sm text-gray-600",children:[S(x.scheduledDate)," ",B(x.scheduledTime)]})]}),e.jsx("button",{onClick:()=>D(null),className:"text-gray-500 hover:text-gray-900",children:"âœ•"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-gray-100 pb-2",children:[e.jsx("h4",{className:"text-lg font-bold text-gray-900",children:"Job Photos"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"w-4 h-4 text-primary"}),e.jsx("span",{className:"text-xs text-gray-500 font-medium tracking-wide uppercase",children:"Capture Work"})]})]}),e.jsx(Ye,{bookingId:x.id,uploaderId:n.id})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-700",children:"Time Logs"}),e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-3 max-h-40 overflow-y-auto",children:(J.data??[]).length>0?e.jsx("ul",{className:"space-y-2 text-sm text-gray-700",children:(J.data??[]).map(s=>e.jsxs("li",{className:"border-b border-gray-200 pb-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:new Date(s.startTime).toLocaleString()}),e.jsx("span",{children:s.endTime?new Date(s.endTime).toLocaleString():"Active"})]}),(s.lat||s.lng||s.locationNote)&&e.jsxs("div",{className:"text-xs text-gray-500",children:[s.lat&&s.lng?`GPS: ${s.lat.toFixed(3)},${s.lng.toFixed(3)} `:"",s.locationNote?`â€¢ ${s.locationNote}`:""]})]},s.id))}):e.jsx("p",{className:"text-sm text-gray-600",children:"No time logs yet."})})]})]})}),b&&e.jsx(He,{request:b,onClose:()=>f(null),onSubmit:De,isSubmitting:ee.isPending}),j&&e.jsx(Ve,{booking:v.data?.bookings.find(s=>s.id===j),onClose:fe,onToggleItem:be,isUpdating:se.isPending})]})};export{hs as component};
