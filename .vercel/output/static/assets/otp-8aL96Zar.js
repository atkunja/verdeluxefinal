import{j as e,u as h,a as g,b as f,k as u,d as y,z as i}from"./index-D68JyPnQ.js";import{u as b}from"./BookingWizardProvider-CZ44CSfS.js";import{b as j}from"./analytics-Cg1IkZOG.js";import{i as k,b as w}from"./styles-CoJu3Vce.js";import{Q as v}from"./QuizIdentityLayout-_IpR82wO.js";function N(){const n=h(),d=g(),{draft:r}=b(),p=f(t=>t.setAuth),[s,x]=u.useState(""),[c,a]=u.useState(null),o=y(d.booking.verifyQuizOtp.mutationOptions()),l=()=>{if(!/^[0-9]{6}$/.test(s)){a("Please enter the 6-digit code we sent you");return}o.mutate({phone:r.contact.phone||"",code:s},{onSuccess:t=>{j.selectionMade("returning-otp",!0),t.token&&t.user?(p(t.token,t.user),i.success("Welcome back!"),n({to:"/client-portal"})):(i.error("No account found with this phone number. Please register first."),n({to:"/booking-quiz/new/phone"}))},onError:t=>i.error(t.message||"Invalid code")})};return e.jsx(v,{title:"Verify Identity",subtitle:`Enter the 6-digit verification code sent to ${r.contact.phone||""}.`,children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-bold text-[#163022] uppercase tracking-wider",children:"Verification Code"}),e.jsx("input",{className:`${k} mt-2 py-4 text-center text-3xl tracking-[1em] font-mono border-2 focus:border-[#163022] transition-colors`,value:s,onChange:t=>{const m=t.target.value.replace(/\D/g,"").slice(0,6);x(m),a(null)},placeholder:"000000",inputMode:"numeric",autoFocus:!0,onKeyDown:t=>t.key==="Enter"&&l()}),c&&e.jsxs("p",{className:"mt-2 text-sm font-medium text-red-600 flex items-center gap-1",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),e.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]}),c]})]}),e.jsx("button",{type:"button",className:`${w} w-full py-4 text-lg shadow-xl active:scale-[0.98] disabled:opacity-70`,onClick:l,disabled:o.isPending,children:o.isPending?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Verifying..."]}):"Sign In"}),e.jsxs("p",{className:"text-center text-xs text-[#5c5a55]",children:["Didn't receive the code? ",e.jsx("button",{type:"button",onClick:()=>n({to:"/booking-quiz/returning/phone"}),className:"font-bold underline",children:"Try again"})]})]})})}const E=function(){return e.jsx(N,{})};export{E as component};
