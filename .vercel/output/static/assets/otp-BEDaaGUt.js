import{j as e,u as g,a as h,b as y,k as l,d as j,z as u}from"./index-D68JyPnQ.js";import{u as v}from"./BookingWizardProvider-CZ44CSfS.js";import{b}from"./analytics-Cg1IkZOG.js";import{i as w,b as k}from"./styles-CoJu3Vce.js";import{Q as N}from"./QuizIdentityLayout-_IpR82wO.js";function C(){const o=g(),d=h(),{draft:s,updateDraft:m}=v(),{setAuth:p}=y(),[n,x]=l.useState(""),[r,c]=l.useState(null),i=j(d.booking.verifyQuizOtp.mutationOptions()),a=()=>{if(!/^[0-9]{6}$/.test(n)){c("Please enter the 6-digit code we sent you");return}i.mutate({phone:s.contact.phone||"",code:n},{onSuccess:t=>{b.selectionMade("otp-verified",!0),u.success("Identity verified"),t.token&&t.user?(console.log("[NewOtp] Found existing user during verification, logging in..."),p(t.token,t.user),m({contact:{...s.contact,email:t.user.email,fullName:`${t.user.firstName||""} ${t.user.lastName||""}`.trim()||s.contact.fullName}}),o({to:"/booking-quiz/clean/type"})):o({to:"/booking-quiz/new/create-account"})},onError:t=>u.error(t.message||"Invalid code")})};return e.jsx(N,{title:"Verify your code",subtitle:`We've sent a secure 6-digit code to your phone ${s.contact.phone||""}.`,children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-bold text-[#163022] uppercase tracking-wider",children:"Verification Code"}),e.jsx("input",{className:`${w} mt-2 py-4 text-center text-3xl tracking-[1em] font-mono border-2 focus:border-[#163022] transition-colors`,value:n,onChange:t=>{const f=t.target.value.replace(/\D/g,"").slice(0,6);x(f),c(null)},placeholder:"000000",inputMode:"numeric",autoFocus:!0,onKeyDown:t=>t.key==="Enter"&&a()}),r&&e.jsxs("p",{className:"mt-2 text-sm font-medium text-red-600 flex items-center gap-1",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),e.jsx("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})]}),r]})]}),e.jsx("button",{type:"button",className:`${k} w-full py-4 text-lg shadow-xl active:scale-[0.98] disabled:opacity-70`,onClick:a,disabled:i.isPending,children:i.isPending?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsxs("svg",{className:"animate-spin h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Verifying..."]}):"Verify Identity"}),e.jsxs("p",{className:"text-center text-xs text-[#5c5a55]",children:["Didn't receive the code? ",e.jsx("button",{type:"button",onClick:()=>o({to:"/booking-quiz/new/phone"}),className:"font-bold underline",children:"Try again"})]})]})})}const M=function(){return e.jsx(C,{})};export{M as component};
