import{c as _,a as R,r as m,g as T,d as g,z as n,j as e,A as $,T as k}from"./index-D68JyPnQ.js";import{S as w}from"./square-check-big-DlVo-rQ2.js";import{S as v}from"./square-CdDjSuHm.js";import{U as q}from"./user-plus-D9h12H7H.js";import{P as B}from"./pencil-CG31BmeG.js";/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],Q=_("shield-check",F);function V({onEdit:y,onDelete:i}){return e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:y,className:"rounded-lg border border-gray-200 bg-white p-2 text-gray-600 hover:bg-gray-50",children:e.jsx(B,{className:"h-4 w-4"})}),e.jsx("button",{onClick:i,className:"rounded-lg border border-gray-200 bg-white p-2 text-gray-600 hover:bg-gray-50",children:e.jsx(k,{className:"h-4 w-4"})})]})}const Y=function(){const i=R(),[r,C]=m.useState("customers"),b={customers:"CLIENT",cleaners:"CLEANER",admins:"ADMIN"},o=T(i.getAllUsersAdmin.queryOptions({role:b[r]})),d=o.data?.users||[],[l,p]=m.useState(new Set),[S,x]=m.useState(!1),[u,f]=m.useState(null),[a,c]=m.useState({name:"",email:"",phone:"",role:""}),A=g(i.deleteUserAdmin.mutationOptions({onSuccess:()=>{n.success("User deleted"),o.refetch()}})),M=g(i.bulk.bulkDeleteUsers.mutationOptions({onSuccess:()=>{n.success("Users deleted"),p(new Set),o.refetch()}})),D=g(i.updateUserAdmin.mutationOptions({onSuccess:()=>{n.success("User updated"),x(!1),o.refetch()}})),E=g(i.createUserAdmin.mutationOptions({onSuccess:()=>{n.success("User created"),x(!1),o.refetch()}})),j=m.useMemo(()=>r==="customers"?"Customer":r==="cleaners"?"Cleaner":"Admin",[r]),P=()=>{l.size===d.length?p(new Set):p(new Set(d.map(s=>s.id)))},U=s=>{const t=new Set(l);t.has(s)?t.delete(s):t.add(s),p(t)},z=async()=>{if(l.size!==0&&confirm(`Delete ${l.size} users?`))try{await M.mutateAsync({userIds:Array.from(l)})}catch(s){n.error(s.message)}},N=(s,t)=>{s==="edit"&&t?(f(t.id),c({name:`${t.firstName||""} ${t.lastName||""}`.trim(),email:t.email,phone:t.phone||"",role:t.role,permissions:t.adminPermissions||{}})):(f(null),c({name:"",email:"",phone:"",role:b[r],permissions:{}})),x(!0)},I=async()=>{if(!a.name||!a.email){n.error("Name and Email are required");return}const[s,...t]=a.name.split(" "),h=t.join(" ");try{u?await D.mutateAsync({userId:u,firstName:s,lastName:h,email:a.email,phone:a.phone,role:a.role,adminPermissions:a.permissions}):await E.mutateAsync({firstName:s,lastName:h,email:a.email,phone:a.phone,role:a.role,adminPermissions:a.permissions,password:"VerdeLuxeTemp123!"})}catch(O){n.error(O.message)}},L=async s=>{if(confirm("Delete this user?"))try{await A.mutateAsync({userId:s})}catch(t){n.error(t.message)}};return e.jsxs($,{title:"Management",subtitle:"Customers, cleaners, and admins.",actions:e.jsxs("div",{className:"flex gap-2",children:[l.size>0&&e.jsxs("button",{onClick:z,className:"inline-flex items-center gap-2 rounded-xl bg-red-50 px-4 py-2 text-sm font-semibold text-red-600 border border-red-100 shadow-sm transition-all hover:bg-red-100",children:[e.jsx(k,{className:"h-4 w-4"}),"Delete (",l.size,")"]}),e.jsxs("button",{onClick:()=>N("create"),className:"inline-flex items-center gap-2 rounded-xl bg-[#163022] px-4 py-2 text-sm font-semibold text-white shadow hover:bg-[#0f241a]",children:[e.jsx(q,{className:"h-4 w-4"}),"Create ",j]})]}),children:[e.jsx("div",{className:"mb-4 flex flex-wrap gap-2 rounded-xl border border-gray-200 bg-white p-1",children:["customers","cleaners","admins"].map(s=>e.jsx("button",{onClick:()=>C(s),className:`rounded-lg px-4 py-2 text-sm font-semibold ${r===s?"bg-[#163022] text-white":"text-gray-700"}`,children:s.charAt(0).toUpperCase()+s.slice(1)},s))}),e.jsx("div",{className:"overflow-hidden rounded-2xl border border-gray-200 bg-white shadow-sm",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 text-left text-sm",children:[e.jsx("thead",{className:"bg-[#f9fafb] text-xs font-semibold text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"w-10 px-4 py-3",children:e.jsx("button",{onClick:P,children:l.size===d.length&&d.length>0?e.jsx(w,{className:"h-4 w-4 text-primary"}):e.jsx(v,{className:"h-4 w-4 text-gray-400"})})}),e.jsx("th",{className:"px-4 py-3",children:"Name"}),e.jsx("th",{className:"px-4 py-3",children:"Email"}),e.jsx("th",{className:"px-4 py-3",children:"Phone"}),e.jsx("th",{className:"px-4 py-3",children:"Joined / Role"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-100",children:[d.map(s=>e.jsxs("tr",{className:"hover:bg-[#f9fafb]",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("button",{onClick:()=>U(s.id),children:l.has(s.id)?e.jsx(w,{className:"h-4 w-4 text-primary"}):e.jsx(v,{className:"h-4 w-4 text-gray-400"})})}),e.jsxs("td",{className:"px-4 py-3 font-semibold text-[#0f172a]",children:[s.firstName," ",s.lastName]}),e.jsx("td",{className:"px-4 py-3 text-gray-700",children:s.email}),e.jsx("td",{className:"px-4 py-3 text-gray-700",children:s.phone||"—"}),e.jsxs("td",{className:"px-4 py-3 text-gray-500",children:[new Date(s.createdAt).toLocaleDateString()," ",r==="admins"&&`• ${s.role}`]}),e.jsx("td",{className:"px-4 py-3 text-right text-gray-700",children:e.jsx(V,{onEdit:()=>N("edit",s),onDelete:()=>L(s.id)})})]},s.id)),o.isLoading&&e.jsx("tr",{children:e.jsxs("td",{colSpan:6,className:"px-4 py-8 text-center text-gray-400 italic",children:["Loading ",r,"..."]})}),!o.isLoading&&d.length===0&&e.jsx("tr",{children:e.jsxs("td",{colSpan:6,className:"px-4 py-8 text-center text-gray-400 italic",children:["No ",r," found."]})})]})]})}),S&&e.jsx("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-black/40 p-4",children:e.jsxs("div",{className:"w-full max-w-md rounded-2xl border border-gray-200 bg-white p-5 shadow-2xl",children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-lg font-semibold text-[#0f172a]",children:[u?"Edit":"Create"," ",j]}),e.jsx("div",{className:"text-xs text-gray-500",children:"Save to mock store"})]}),e.jsx("button",{className:"text-sm text-gray-500",onClick:()=>x(!1),children:"Close"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"block text-sm text-gray-700",children:["Name",e.jsx("input",{value:a.name,onChange:s=>c(t=>({...t,name:s.target.value})),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 text-sm"})]}),(r==="customers"||r==="cleaners")&&e.jsxs(e.Fragment,{children:[e.jsxs("label",{className:"block text-sm text-gray-700",children:["Email",e.jsx("input",{value:a.email,onChange:s=>c(t=>({...t,email:s.target.value})),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 text-sm"})]}),e.jsxs("label",{className:"block text-sm text-gray-700",children:["Phone",e.jsx("input",{value:a.phone,onChange:s=>c(t=>({...t,phone:s.target.value})),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 text-sm"})]})]}),r==="admins"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("label",{className:"block text-sm text-gray-700",children:["Role",e.jsxs("select",{value:a.role,onChange:s=>c(t=>({...t,role:s.target.value})),className:"mt-1 w-full rounded-lg border border-gray-200 px-3 py-2 text-sm",children:[e.jsx("option",{value:"ADMIN",children:"Admin"}),e.jsx("option",{value:"OWNER",children:"Owner"})]})]}),e.jsxs("div",{className:"rounded-xl border border-gray-100 bg-gray-50 p-4",children:[e.jsxs("div",{className:"mb-3 flex items-center gap-2 text-sm font-bold text-[#0f172a]",children:[e.jsx(Q,{className:"h-4 w-4 text-primary"}),"Granular Permissions"]}),e.jsx("div",{className:"grid grid-cols-2 gap-3",children:[{key:"manage_bookings",label:"Bookings"},{key:"manage_customers",label:"Customers"},{key:"manage_cleaners",label:"Cleaners"},{key:"manage_accounting",label:"Accounting"},{key:"view_reports",label:"Reports"},{key:"manage_settings",label:"Settings"}].map(s=>e.jsxs("label",{className:"flex items-center gap-2 text-xs text-gray-600 cursor-pointer hover:text-[#0f172a]",children:[e.jsx("input",{type:"checkbox",checked:!!a.permissions?.[s.key],onChange:t=>c(h=>({...h,permissions:{...h.permissions,[s.key]:t.target.checked}})),className:"rounded border-gray-300 text-primary focus:ring-primary"}),s.label]},s.key))})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>x(!1),className:"rounded-lg px-4 py-2 text-sm font-semibold text-gray-600 hover:bg-gray-100",children:"Cancel"}),e.jsx("button",{onClick:I,className:"rounded-lg bg-[#163022] px-4 py-2 text-sm font-semibold text-white shadow",children:"Save"})]})]})]})})]})};export{Y as component};
