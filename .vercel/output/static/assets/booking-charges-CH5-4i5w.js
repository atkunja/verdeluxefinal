import{u as D,a as M,b as P,f as Q,r as l,g as A,d as c,z as r,j as e}from"./index-D68JyPnQ.js";import{P as F}from"./PortalLayout-DFkXF_dG.js";import{f as b}from"./formatTime-R4Jm2Dpf.js";import"./Footer-CWCGcQgO.js";import"./map-pin-BUW29wY0.js";import"./calendar-sVqVbs5g.js";function B({charges:j,holds:x,refunds:a}){const d=[];return j.forEach(t=>d.push({label:t.description||"Charge",amount:t.amount,status:t.status,createdAt:t.created,kind:"charge"})),x.forEach(t=>d.push({label:t.description||"Hold",amount:t.amount,status:t.status,createdAt:t.created,kind:"hold"})),(a||[]).forEach(t=>d.push({label:t.description||"Refund",amount:t.amount,status:t.status,createdAt:t.created,kind:"refund"})),d.sort((t,n)=>{const i=t.createdAt?new Date(t.createdAt).getTime():0;return(n.createdAt?new Date(n.createdAt).getTime():0)-i})}const z=function(){const x=D(),a=M(),{token:d,user:t}=P(),n=Q(),[i,y]=l.useState(""),[p,f]=l.useState("");l.useEffect(()=>{(!d||!t||t.role!=="ADMIN"&&t.role!=="OWNER")&&x({to:"/login"})},[d,t,x]);const u=A(a.payments.listCharges.queryOptions(void 0,{enabled:!!d})),m=A(a.payments.listHolds.queryOptions(void 0,{enabled:!!d})),[h,H]=l.useState(""),[g,I]=l.useState(""),N=c(a.stripe.refundPayment.mutationOptions({onSuccess:()=>{r.success("Refund issued"),n.invalidateQueries({queryKey:a.payments.listCharges.queryKey()})},onError:s=>r.error(s.message||"Refund failed")})),q=c(a.payments.captureHold.mutationOptions({onSuccess:()=>{r.success("Hold captured"),n.invalidateQueries({queryKey:a.payments.listHolds.queryKey()}),n.invalidateQueries({queryKey:a.payments.listCharges.queryKey()})},onError:s=>r.error(s.message||"Failed to capture")})),S=c(a.payments.cancelHold.mutationOptions({onSuccess:()=>{r.success("Hold canceled"),n.invalidateQueries({queryKey:a.payments.listHolds.queryKey()})},onError:s=>r.error(s.message||"Failed to cancel")})),v=c(a.payments.createHold.mutationOptions({onSuccess:()=>{r.success("Hold created"),f(""),y(""),n.invalidateQueries({queryKey:a.payments.listHolds.queryKey()})},onError:s=>r.error(s.message||"Failed to create hold")})),E=c(a.payments.updateHold.mutationOptions({onSuccess:()=>{r.success("Hold adjusted"),n.invalidateQueries({queryKey:a.payments.listHolds.queryKey()})},onError:s=>r.error(s.message||"Failed to adjust hold")})),C=u.data??[],w=m.data??[],k=B({charges:C,holds:w});return e.jsx(F,{portalType:"admin",children:e.jsxs("div",{className:"bg-gray-50 min-h-screen",children:[e.jsx("div",{className:"bg-emerald-900 text-white",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Booking Charges"}),e.jsx("p",{className:"text-sm text-white/80",children:"Manage payments, holds, and refunds for all bookings."})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-6 space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 border-b border-gray-200 px-4 py-3 text-sm font-semibold text-gray-700",children:[e.jsx("span",{className:"px-3 py-2 border-b-2 border-primary text-primary",children:"Pending Charges"}),e.jsx("span",{className:"px-3 py-2 text-gray-600",children:"Card Hold(s)"}),e.jsx("span",{className:"px-3 py-2 text-gray-600",children:"Declined Charges"}),e.jsx("span",{className:"px-3 py-2 text-gray-600",children:"All Charges"})]}),e.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 flex flex-wrap gap-3 text-sm text-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"date",className:"border border-[#d7d1c4] bg-[#f7f4ed] text-[#163022] rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent placeholder:text-gray-500"}),e.jsx("input",{type:"date",className:"border border-[#d7d1c4] bg-[#f7f4ed] text-[#163022] rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent placeholder:text-gray-500"})]}),e.jsx("input",{type:"text",placeholder:"Search",className:"border border-[#d7d1c4] bg-[#f7f4ed] text-[#163022] rounded-lg px-3 py-2 flex-1 min-w-[200px] focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent placeholder:text-gray-500"})]}),e.jsxs("div",{className:"divide-y divide-gray-100",children:[e.jsxs("div",{className:"grid grid-cols-7 px-4 py-3 text-xs font-semibold text-gray-500 uppercase tracking-wide",children:[e.jsx("span",{children:"Description"}),e.jsx("span",{children:"Booking"}),e.jsx("span",{children:"Amount"}),e.jsx("span",{children:"Status"}),e.jsx("span",{children:"Method"}),e.jsx("span",{children:"Currency"}),e.jsx("span",{className:"text-right",children:"Actions"})]}),u.isLoading?e.jsx("div",{className:"px-4 py-6 text-sm text-gray-600",children:"Loading charges..."}):u.isError?e.jsx("div",{className:"px-4 py-6 text-sm text-red-600",children:"Failed to load charges."}):(u.data||[]).length===0?e.jsx("div",{className:"px-4 py-6 text-sm text-gray-600",children:"No charges."}):C.map(s=>e.jsxs("div",{className:"grid grid-cols-7 items-center px-4 py-3 text-sm hover:bg-gray-50",children:[e.jsxs("div",{className:"text-gray-800",children:[e.jsx("div",{className:"font-semibold",children:s.description||"Charge"}),e.jsxs("div",{className:"text-xs text-gray-500",children:[s.bookingId?`Booking #${s.bookingId}`:"Manual"," • ",s.id.slice(-6)]}),s.created&&e.jsxs("div",{className:"text-xs text-gray-500",children:["Created ",b(s.created)]})]}),e.jsx("div",{className:"text-gray-700",children:s.bookingId?`#${s.bookingId}`:"-"}),e.jsxs("div",{className:"text-green-700 font-semibold",children:["$",Number(s.amount).toFixed(2)]}),e.jsx("div",{className:"text-xs text-gray-700 uppercase",children:s.status==="succeeded"?"PAID":s.status?.toUpperCase()}),e.jsx("div",{className:"text-xs text-gray-700",children:s.paymentMethod||"—"}),e.jsx("div",{className:"text-xs text-gray-600",children:s.currency?.toUpperCase()}),e.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[e.jsx("input",{type:"number",min:0,step:"0.01",placeholder:"Amount",className:"w-24 px-2 py-1 border border-[#d7d1c4] bg-[#f7f4ed] text-[#163022] rounded focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent placeholder:text-gray-500",value:h,onChange:o=>H(o.target.value)}),e.jsx("button",{className:"px-3 py-1 bg-green-600 text-white rounded-lg text-xs",onClick:()=>N.mutate({paymentIntentId:s.paymentIntentId||s.id,amount:h?Number(h):void 0}),disabled:N.isPending,children:"Refund"})]})]},s.id))]})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm",children:[e.jsx("div",{className:"flex flex-wrap gap-2 border-b border-gray-200 px-4 py-3 text-sm font-semibold text-gray-700",children:e.jsx("span",{className:"px-3 py-2 border-b-2 border-primary text-primary",children:"Card Hold(s)"})}),e.jsxs("div",{className:"px-4 py-3 border-b border-gray-200 grid gap-3 md:grid-cols-3 text-sm text-gray-700",children:[e.jsx("input",{type:"number",placeholder:"Booking ID (optional)",value:i,onChange:s=>y(s.target.value===""?"":Number(s.target.value)),className:"border border-[#d7d1c4] bg-[#f7f4ed] text-[#163022] rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent placeholder:text-gray-500"}),e.jsx("input",{type:"number",placeholder:"Hold amount",value:p,onChange:s=>f(s.target.value===""?"":Number(s.target.value)),className:"border border-[#d7d1c4] bg-[#f7f4ed] text-[#163022] rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent placeholder:text-gray-500"}),e.jsx("button",{onClick:()=>{if(!p||Number(p)<=0){r.error("Enter a valid amount");return}v.mutate({amount:Number(p),bookingId:i===""?void 0:Number(i)})},className:"px-4 py-2 bg-emerald-600 text-white rounded-lg text-sm font-semibold hover:bg-emerald-700 transition disabled:opacity-60",disabled:v.isPending,children:"Create Hold"})]}),e.jsxs("div",{className:"divide-y divide-gray-100",children:[e.jsxs("div",{className:"grid grid-cols-6 px-4 py-3 text-xs font-semibold text-gray-500 uppercase tracking-wide",children:[e.jsx("span",{children:"Description"}),e.jsx("span",{children:"Booking"}),e.jsx("span",{children:"Hold Amount"}),e.jsx("span",{children:"Status"}),e.jsx("span",{children:"Currency"}),e.jsx("span",{className:"text-right",children:"Actions"})]}),m.isLoading?e.jsx("div",{className:"px-4 py-6 text-sm text-gray-600",children:"Loading holds..."}):m.isError?e.jsx("div",{className:"px-4 py-6 text-sm text-red-600",children:"Failed to load holds."}):(m.data||[]).length===0?e.jsx("div",{className:"px-4 py-6 text-sm text-gray-600",children:"No holds."}):w.map(s=>{const o=s.status==="requires_capture"?"Held - awaiting capture":s.status;return e.jsxs("div",{className:"grid grid-cols-6 items-center px-4 py-3 text-sm hover:bg-gray-50",children:[e.jsxs("div",{className:"text-gray-800",children:[e.jsx("div",{className:"font-semibold",children:s.description||"Card hold"}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Intent: ",s.id]}),s.created&&e.jsxs("div",{className:"text-xs text-gray-500",children:["Created ",b(s.created)]})]}),e.jsx("div",{className:"text-gray-700",children:s.bookingId?`#${s.bookingId}`:"-"}),e.jsxs("div",{className:"text-green-700 font-semibold",children:["$",Number(s.amount).toFixed(2)]}),e.jsx("div",{className:"text-xs text-gray-700 uppercase",children:o}),e.jsx("div",{className:"text-xs text-gray-600",children:s.currency?.toUpperCase()}),e.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[e.jsx("input",{type:"number",min:0,step:"0.01",placeholder:"New amt",className:"w-20 px-2 py-1 border border-[#d7d1c4] bg-[#f7f4ed] text-[#163022] rounded focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent placeholder:text-gray-500",value:g,onChange:K=>I(K.target.value)}),e.jsx("button",{onClick:()=>E.mutate({paymentIntentId:s.id,amount:Number(g||s.amount),description:s.description}),className:"px-3 py-1 bg-blue-600 text-white rounded-lg text-xs disabled:opacity-60",disabled:!g,children:"Adjust"}),e.jsx("button",{onClick:()=>q.mutate({paymentIntentId:s.id}),className:"px-3 py-1 bg-emerald-600 text-white rounded-lg text-xs",children:"Capture"}),e.jsx("button",{onClick:()=>S.mutate({paymentIntentId:s.id}),className:"px-3 py-1 bg-red-100 text-red-700 rounded-lg text-xs",children:"Cancel"})]})]},s.id)})]})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm",children:[e.jsx("div",{className:"border-b border-gray-200 px-4 py-3 text-sm font-semibold text-gray-700",children:"Payment Timeline"}),k.length===0?e.jsx("div",{className:"px-4 py-6 text-sm text-gray-600",children:"No payments or holds yet."}):e.jsxs("div",{className:"divide-y divide-gray-100",children:[e.jsxs("div",{className:"grid grid-cols-4 px-4 py-3 text-xs font-semibold text-gray-500 uppercase tracking-wide",children:[e.jsx("span",{children:"Type"}),e.jsx("span",{children:"Amount"}),e.jsx("span",{children:"Status"}),e.jsx("span",{children:"Date"})]}),k.map((s,o)=>e.jsxs("div",{className:"grid grid-cols-4 px-4 py-3 text-sm hover:bg-gray-50",children:[e.jsx("span",{className:"font-semibold text-gray-900",children:s.label||s.kind.toUpperCase()}),e.jsx("span",{className:"text-gray-800",children:s.amount!==void 0?`$${Number(s.amount).toFixed(2)}`:"—"}),e.jsx("span",{className:"text-xs uppercase text-gray-700",children:s.status||"N/A"}),e.jsx("span",{className:"text-xs text-gray-600",children:s.createdAt?b(s.createdAt):"—"})]},o))]})]})]})]})})};export{z as component};
