import{r as j,a as A,g as T,d as y,j as e,A as R,p as x,n as w,T as E}from"./index-D68JyPnQ.js";import{L as M}from"./loader-circle-ZVWRwCK0.js";import{P as k}from"./plus-BeADQoDx.js";import{P as C}from"./pencil-CG31BmeG.js";function S({rule:s,onDelete:p,onUpdate:u}){const[d,t]=j.useState(!1),n=A(),a=y(n.updatePricingRule.mutationOptions()),b=async o=>{o.preventDefault();const r=new FormData(o.currentTarget),l=g=>{const h=r.get(g);return h?Number(h):null};try{await a.mutateAsync({ruleId:s.id,name:r.get("name"),ruleType:r.get("ruleType"),serviceType:r.get("serviceType")||null,priceAmount:l("priceAmount"),ratePerUnit:l("ratePerUnit"),timeAmount:l("timeAmount"),timePerUnit:l("timePerUnit"),extraName:r.get("extraName")||null,extraDescription:r.get("extraDescription")||null,isActive:r.get("isActive")==="on",displayOrder:l("displayOrder")||0,priceRangeMin:l("priceRangeMin"),priceRangeMax:l("priceRangeMax")}),x.success("Rule updated"),t(!1),u()}catch{x.error("Failed to update rule")}};return d?e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"p-4 bg-gray-50",children:e.jsx(P,{initialData:s,onSubmit:b,onCancel:()=>t(!1)})})}):e.jsxs("tr",{className:"hover:bg-gray-50/50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3 font-mono text-gray-500",children:s.displayOrder}),e.jsx("td",{className:"px-4 py-3 font-medium",children:s.name}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded bg-blue-50 text-blue-700 text-xs font-semibold",children:s.ruleType})}),e.jsxs("td",{className:"px-4 py-3 text-gray-600",children:[s.serviceType&&e.jsxs("div",{className:"text-xs uppercase tracking-wide text-gray-400",children:["Service: ",s.serviceType]}),s.extraName&&e.jsx("div",{className:"font-medium",children:s.extraName})]}),e.jsxs("td",{className:"px-4 py-3",children:[s.priceAmount!==null&&e.jsxs("div",{className:"font-medium",children:["$",s.priceAmount]}),s.ratePerUnit!==null&&e.jsxs("div",{className:"text-gray-600",children:["$",s.ratePerUnit," / unit"]}),(s.priceRangeMin!==null||s.priceRangeMax!==null)&&e.jsxs("div",{className:"text-xs text-gray-400 mt-1",children:["Range: ",s.priceRangeMin??"0"," - ",s.priceRangeMax??"âˆž"]})]}),e.jsxs("td",{className:"px-4 py-3 text-gray-600",children:[s.timeAmount!==null&&e.jsxs("div",{children:[s.timeAmount," hrs"]}),s.timePerUnit!==null&&e.jsxs("div",{children:[s.timePerUnit," hrs/unit"]})]}),e.jsx("td",{className:"px-4 py-3",children:s.isActive?e.jsxs("span",{className:"inline-flex items-center gap-1 text-emerald-600 text-xs font-medium",children:[e.jsx(w,{className:"w-3 h-3"})," Active"]}):e.jsx("span",{className:"inline-flex items-center gap-1 text-gray-400 text-xs font-medium",children:"Inactive"})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>t(!0),className:"p-1 text-gray-400 hover:text-primary transition-colors",children:e.jsx(C,{className:"w-4 h-4"})}),e.jsx("button",{onClick:p,className:"p-1 text-gray-400 hover:text-red-500 transition-colors",children:e.jsx(E,{className:"w-4 h-4"})})]})})]})}function P({initialData:s,onSubmit:p,onCancel:u}){const[d,t]=j.useState(s?.ruleType||"BASE_PRICE"),n=["BASE_PRICE","SQFT_RATE","BEDROOM_RATE","BATHROOM_RATE","EXTRA_SERVICE","TIME_ESTIMATE"];return e.jsxs("form",{onSubmit:p,className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsx("div",{className:"col-span-full flex justify-between",children:e.jsx("h4",{className:"font-bold text-gray-800",children:"Rule Details"})}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-500 uppercase mb-1",children:"Rule Name"}),e.jsx("input",{required:!0,name:"name",defaultValue:s?.name,className:"w-full px-3 py-2 border rounded text-sm",placeholder:"e.g. Standard Cleaning Base"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-500 uppercase mb-1",children:"Rule Type"}),e.jsx("select",{name:"ruleType",value:d,onChange:a=>t(a.target.value),className:"w-full px-3 py-2 border rounded text-sm",children:n.map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-500 uppercase mb-1",children:"Service Type (Optional)"}),e.jsx("input",{name:"serviceType",defaultValue:s?.serviceType,className:"w-full px-3 py-2 border rounded text-sm",placeholder:"e.g. standard, deep"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-500 uppercase mb-1",children:"Display Order"}),e.jsx("input",{type:"number",name:"displayOrder",defaultValue:s?.displayOrder||0,className:"w-full px-3 py-2 border rounded text-sm"})]}),e.jsx("div",{className:"form-group flex items-center pt-6",children:e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",name:"isActive",defaultChecked:s?.isActive??!0}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Is Active?"})]})}),e.jsx("div",{className:"col-span-full h-px bg-gray-100 my-2"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-500 uppercase mb-1",children:"Flat Price ($)"}),e.jsx("input",{type:"number",step:"0.01",name:"priceAmount",defaultValue:s?.priceAmount,className:"w-full px-3 py-2 border rounded text-sm"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-500 uppercase mb-1",children:"Rate ($ per unit)"}),e.jsx("input",{type:"number",step:"0.001",name:"ratePerUnit",defaultValue:s?.ratePerUnit,className:"w-full px-3 py-2 border rounded text-sm"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-500 uppercase mb-1",children:"Min Price ($)"}),e.jsx("input",{type:"number",step:"0.01",name:"priceRangeMin",defaultValue:s?.priceRangeMin,className:"w-full px-3 py-2 border rounded text-sm"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-500 uppercase mb-1",children:"Max Price ($)"}),e.jsx("input",{type:"number",step:"0.01",name:"priceRangeMax",defaultValue:s?.priceRangeMax,className:"w-full px-3 py-2 border rounded text-sm"})]}),e.jsx("div",{className:"col-span-full h-px bg-gray-100 my-2"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-500 uppercase mb-1",children:"Flat Time (Hours)"}),e.jsx("input",{type:"number",step:"0.1",name:"timeAmount",defaultValue:s?.timeAmount,className:"w-full px-3 py-2 border rounded text-sm"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-500 uppercase mb-1",children:"Time Rate (Hours per unit)"}),e.jsx("input",{type:"number",step:"0.01",name:"timePerUnit",defaultValue:s?.timePerUnit,className:"w-full px-3 py-2 border rounded text-sm"})]}),d==="EXTRA_SERVICE"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-span-full h-px bg-gray-100 my-2"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-500 uppercase mb-1",children:"Extra Name"}),e.jsx("input",{name:"extraName",defaultValue:s?.extraName,className:"w-full px-3 py-2 border rounded text-sm"})]}),e.jsxs("div",{className:"form-group col-span-2",children:[e.jsx("label",{className:"block text-xs font-semibold text-gray-500 uppercase mb-1",children:"Description"}),e.jsx("input",{name:"extraDescription",defaultValue:s?.extraDescription,className:"w-full px-3 py-2 border rounded text-sm"})]})]}),e.jsxs("div",{className:"col-span-full flex justify-end gap-3 mt-4",children:[e.jsx("button",{type:"button",onClick:u,className:"px-4 py-2 text-sm text-gray-600 hover:text-black",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 text-sm bg-primary text-white rounded hover:bg-primary-dark",children:"Save Rule"})]})]})}const F=function(){const[p,u]=j.useState(null),[d,t]=j.useState(!1),n=A(),{data:a,isLoading:b,refetch:o}=T(n.getPricingRules.queryOptions()),r=y(n.createPricingRule.mutationOptions());y(n.updatePricingRule.mutationOptions());const l=y(n.deletePricingRule.mutationOptions()),g=async i=>{i.preventDefault();const c=new FormData(i.currentTarget),m=f=>{const v=c.get(f);return v?Number(v):null};try{await r.mutateAsync({name:c.get("name"),ruleType:c.get("ruleType"),serviceType:c.get("serviceType")||null,priceAmount:m("priceAmount"),ratePerUnit:m("ratePerUnit"),timeAmount:m("timeAmount"),timePerUnit:m("timePerUnit"),extraName:c.get("extraName")||null,extraDescription:c.get("extraDescription")||null,isActive:c.get("isActive")==="on",displayOrder:m("displayOrder")||0,priceRangeMin:m("priceRangeMin"),priceRangeMax:m("priceRangeMax")}),x.success("Rule created"),t(!1),o()}catch{x.error("Failed to create rule")}},h=async i=>{if(confirm("Are you sure?"))try{await l.mutateAsync({ruleId:i}),x.success("Rule deleted"),o()}catch{x.error("Failed to delete rule")}};if(b)return e.jsx(R,{title:"Pricing Rules",children:e.jsx("div",{className:"flex justify-center items-center h-96",children:e.jsx(M,{className:"w-8 h-8 animate-spin text-primary"})})});const N=a?.pricingRules||[];return e.jsx(R,{title:"Pricing Rules",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Pricing Configuration"}),e.jsxs("button",{onClick:()=>t(!0),className:"flex items-center gap-2 bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary-dark transition-colors",children:[e.jsx(k,{className:"w-4 h-4"}),"Add Rule"]})]}),d&&e.jsxs("div",{className:"bg-gray-50 border border-gray-200 rounded-lg p-4 mb-6",children:[e.jsx("h3",{className:"font-semibold mb-4",children:"New Pricing Rule"}),e.jsx(P,{onSubmit:g,onCancel:()=>t(!1)})]}),e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg overflow-hidden shadow-sm",children:e.jsxs("table",{className:"w-full text-left text-sm",children:[e.jsx("thead",{className:"bg-gray-50 text-gray-600 font-medium",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"Order"}),e.jsx("th",{className:"px-4 py-3",children:"Name"}),e.jsx("th",{className:"px-4 py-3",children:"Type"}),e.jsx("th",{className:"px-4 py-3",children:"Service / Extra"}),e.jsx("th",{className:"px-4 py-3",children:"Price / Rate"}),e.jsx("th",{className:"px-4 py-3",children:"Time Impact"}),e.jsx("th",{className:"px-4 py-3",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Actions"})]})}),e.jsxs("tbody",{className:"divide-y divide-gray-100",children:[N.map(i=>e.jsx(S,{rule:i,onDelete:()=>h(i.id),onUpdate:()=>o()},i.id)),N.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"px-4 py-8 text-center text-gray-500",children:"No pricing rules found. Create one to get started."})})]})]})})]})})};export{F as component};
