import{c as C,a as S,f as k,r,g as D,d as b,u as q,j as e,A as M,m as T,B as A}from"./index-D68JyPnQ.js";import{P as E}from"./plus-BeADQoDx.js";/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=[["path",{d:"M13 5h8",key:"a7qcls"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 19h8",key:"c3s6r1"}],["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["path",{d:"m3 7 2 2 4-4",key:"1obspn"}]],P=C("list-checks",O),i=["Incoming","No Response","Hot Leads","Pending Call Back","Offers Made","CONVERTED"],B=function(){const n=S(),g=k(),[l,u]=r.useState("kanban"),[c,j]=r.useState("ALL"),[d,N]=r.useState(""),o=D(n.crm.getLeads.queryOptions()),f=b({...n.crm.updateLead.mutationOptions(),onSuccess:()=>{g.invalidateQueries({queryKey:n.crm.getLeads.queryOptions().queryKey})}}),v=b({...n.crm.convertLeadToBooking.mutationOptions(),onSuccess:()=>{g.invalidateQueries({queryKey:n.crm.getLeads.queryOptions().queryKey})}}),x=r.useMemo(()=>o.data||[],[o.data]),m=r.useMemo(()=>x.filter(t=>{const s=c==="ALL"||t.status===c,a=d.toLowerCase(),L=t.name.toLowerCase().includes(a)||t.email.toLowerCase().includes(a)||t.phone.toLowerCase().includes(a);return s&&L}),[x,c,d]),h=r.useMemo(()=>i.reduce((t,s)=>(t[s]=m.filter(a=>a.status===s),t),{}),[m]),p=(t,s)=>{f.mutate({id:t,status:s})},w=q(),y=async t=>{if(window.confirm("Convert this lead to a booking? This will create a client account."))try{const s=await v.mutateAsync({leadId:t});alert("Lead converted and booking created!"),w({to:"/admin-portal/bookings",search:{selectedId:s.bookingId}})}catch(s){alert("Failed to convert lead: "+s.message)}};return o.isLoading?e.jsx("div",{className:"p-8 text-center",children:"Loading leads..."}):e.jsxs(M,{title:"Leads Pipeline",subtitle:"Track and convert leads.",actions:e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("button",{className:"inline-flex items-center gap-2 rounded-xl bg-[#163022] px-4 py-2 text-sm font-semibold text-white shadow hover:bg-[#0f241a]",children:[e.jsx(E,{className:"h-4 w-4"}),"New Booking/Lead"]}),e.jsxs("span",{className:"rounded-xl border border-gray-200 bg-white px-3 py-2 text-sm text-gray-700",children:["Total Leads: ",x.length]})]}),children:[e.jsxs("div",{className:"mb-4 flex flex-wrap items-center gap-3",children:[e.jsxs("div",{className:"flex items-center rounded-xl border border-gray-200 bg-white px-3 py-2 text-sm text-gray-700",children:[e.jsx(T,{className:"mr-2 h-4 w-4 text-gray-500"}),e.jsx("input",{value:d,onChange:t=>N(t.target.value),placeholder:"Search name, email, phone",className:"w-56 bg-transparent text-sm focus:outline-none"})]}),e.jsxs("select",{value:c,onChange:t=>j(t.target.value),className:"rounded-xl border border-gray-200 bg-white px-3 py-2 text-sm",children:[e.jsx("option",{value:"ALL",children:"All Statuses"}),i.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsxs("div",{className:"ml-auto flex items-center gap-2 rounded-xl border border-gray-200 bg-white p-1",children:[e.jsxs("button",{onClick:()=>u("kanban"),className:`flex items-center gap-1 rounded-lg px-3 py-1.5 text-sm ${l==="kanban"?"bg-[#163022] text-white":"text-gray-700"}`,children:[e.jsx(A,{className:"h-4 w-4"})," Kanban"]}),e.jsxs("button",{onClick:()=>u("list"),className:`flex items-center gap-1 rounded-lg px-3 py-1.5 text-sm ${l==="list"?"bg-[#163022] text-white":"text-gray-700"}`,children:[e.jsx(P,{className:"h-4 w-4"})," List"]})]})]}),l==="kanban"?e.jsx("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-5",children:i.map(t=>e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white p-3 shadow-sm",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("div",{className:"text-sm font-semibold text-[#0f172a]",children:t}),e.jsx("div",{className:"rounded-full bg-[#f5f3ec] px-2 py-1 text-xs text-gray-600",children:h[t]?.length||0})]}),e.jsxs("div",{className:"space-y-3",onDragOver:s=>s.preventDefault(),onDrop:s=>{const a=Number(s.dataTransfer.getData("text/plain"));isNaN(a)||p(a,t)},children:[h[t]?.map(s=>e.jsxs("article",{draggable:!0,onDragStart:a=>a.dataTransfer.setData("text/plain",String(s.id)),className:"cursor-grab rounded-xl border border-gray-200 bg-[#f9fafb] p-3 shadow-[0_1px_2px_rgba(0,0,0,0.05)]",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-sm font-semibold text-[#0f172a]",children:s.name}),e.jsx("span",{className:"text-[11px] text-gray-500 capitalize",children:s.source.toLowerCase().replace("_"," ")})]}),e.jsx("div",{className:"mt-1 text-xs text-gray-500",children:s.email}),e.jsx("div",{className:"text-xs text-gray-500",children:s.phone}),e.jsxs("div",{className:"mt-2 flex items-center justify-between gap-2",children:[e.jsx("div",{className:"rounded-lg bg-white px-2 py-1 text-xs text-gray-700 truncate max-w-[120px]",children:s.message||"No notes"}),t!=="CONVERTED"&&e.jsx("button",{onClick:()=>y(s.id),className:"text-[10px] bg-green-100 text-green-700 px-2 py-1 rounded hover:bg-green-200",children:"Convert"})]}),e.jsxs("div",{className:"mt-2 flex items-center justify-between text-[11px] text-gray-500",children:[e.jsx("span",{children:new Date(s.createdAt).toLocaleDateString()}),e.jsx("select",{value:s.status,onChange:a=>p(s.id,a.target.value),className:"rounded-md border border-gray-200 bg-white px-2 py-1 text-[11px]",children:i.map(a=>e.jsx("option",{value:a,children:a},a))})]})]},s.id)),(h[t]?.length||0)===0&&e.jsx("div",{className:"rounded-lg border border-dashed border-gray-200 bg-[#f9fafb] p-3 text-center text-xs text-gray-500",children:"Drop leads here"})]})]},t))}):e.jsx("div",{className:"overflow-hidden rounded-2xl border border-gray-200 bg-white shadow-sm",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-[#f9fafb] text-left text-xs font-semibold text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3",children:"Lead"}),e.jsx("th",{className:"px-4 py-3",children:"Contact"}),e.jsx("th",{className:"px-4 py-3",children:"Source"}),e.jsx("th",{className:"px-4 py-3",children:"Created"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Status"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100 text-sm",children:m.map(t=>e.jsxs("tr",{className:"hover:bg-[#f9fafb]",children:[e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"font-semibold text-[#0f172a]",children:t.name}),e.jsx("div",{className:"text-xs text-gray-500 truncate max-w-[200px]",children:t.message})]}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("div",{className:"text-sm text-gray-700",children:t.email}),e.jsx("div",{className:"text-xs text-gray-500",children:t.phone})]}),e.jsx("td",{className:"px-4 py-3 text-gray-700 capitalize",children:t.source.toLowerCase().replace("_"," ")}),e.jsx("td",{className:"px-4 py-3 text-gray-500",children:new Date(t.createdAt).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[t.status!=="CONVERTED"&&e.jsx("button",{onClick:()=>y(t.id),className:"text-xs bg-green-100 text-green-700 px-2 py-1.5 rounded hover:bg-green-200",children:"Convert"}),e.jsx("select",{value:t.status,onChange:s=>p(t.id,s.target.value),className:"rounded-lg border border-gray-200 bg-white px-3 py-1.5 text-sm",children:i.map(s=>e.jsx("option",{value:s,children:s},s))})]})})]},t.id))})]})})]})};export{B as component};
