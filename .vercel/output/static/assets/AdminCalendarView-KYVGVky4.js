import{c as te,r as D,j as t}from"./index-D68JyPnQ.js";import{a as x,b as re}from"./formatTime-R4Jm2Dpf.js";import{C as se}from"./calendar-sVqVbs5g.js";import{C as ae,a as ne}from"./loader-DMU7MElH.js";import{P as le}from"./plus-BeADQoDx.js";import{C as oe}from"./clock-04BLIM7u.js";import{S as de}from"./square-check-big-DlVo-rQ2.js";/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],ye=te("arrow-left",ie);function fe({bookings:w,onBookingClick:j,onCreateBooking:Y,onViewChecklist:E,onMoveBooking:$,selectedBookingId:P=null,onClearSelection:A}){const[l,u]=D.useState(new Date),[m,_]=D.useState("month"),[g,p]=D.useState(!1),[y,v]=D.useState(null),B=e=>new Date(e.getFullYear(),e.getMonth(),1),G=e=>new Date(e.getFullYear(),e.getMonth()+1,0),U=e=>{const n=B(e),r=G(e),a=[],d=n.getDay();for(let s=d-1;s>=0;s--){const i=new Date(n);i.setDate(i.getDate()-s-1),a.push(i)}for(let s=1;s<=r.getDate();s++)a.push(new Date(e.getFullYear(),e.getMonth(),s));const o=42-a.length;for(let s=1;s<=o;s++){const i=new Date(r);i.setDate(i.getDate()+s),a.push(i)}return a},C=new Intl.DateTimeFormat("en-CA",{timeZone:"America/Detroit",year:"numeric",month:"2-digit",day:"2-digit"}),f=e=>{const n=C.formatToParts(e).reduce((r,a)=>(a.type==="year"&&(r.year=Number(a.value)),a.type==="month"&&(r.month=Number(a.value)),a.type==="day"&&(r.day=Number(a.value)),r),{});return new Date(n.year??e.getFullYear(),(n.month??1)-1,n.day??e.getDate())},b=e=>{const n=C.formatToParts(e).reduce((r,a)=>(a.type==="year"&&(r.year=Number(a.value)),a.type==="month"&&(r.month=Number(a.value)),a.type==="day"&&(r.day=Number(a.value)),r),{});return w.filter(r=>{const a=C.formatToParts(new Date(r.scheduledDate)).reduce((d,o)=>(o.type==="year"&&(d.year=Number(o.value)),o.type==="month"&&(d.month=Number(o.value)),o.type==="day"&&(d.day=Number(o.value)),d),{});return n.year===a.year&&n.month===a.month&&n.day===a.day})},V=()=>u(new Date(l.getFullYear(),l.getMonth()-1,1)),Z=()=>u(new Date(l.getFullYear(),l.getMonth()+1,1)),z=e=>{const n=new Date;return e.getDate()===n.getDate()&&e.getMonth()===n.getMonth()&&e.getFullYear()===n.getFullYear()},W=e=>e.getMonth()===l.getMonth(),J=U(l),K=new Intl.DateTimeFormat("en-US",{timeZone:"America/Detroit",month:"long"}).format(l),Q=l.getFullYear(),F=()=>{const e=new Date(l);return e.setDate(e.getDate()-e.getDay()),Array.from({length:7}).map((n,r)=>{const a=new Date(e);return a.setDate(e.getDate()+r),a})},R=(e,n,r)=>{if(!r||m==="month"){if(e.scheduledTime){const[k,ee]=e.scheduledTime.split(":").map(Number),L=new Date(n);return L.setHours(k||0,ee||0,0,0),L}return n}const a=r.currentTarget.getBoundingClientRect(),o=Math.max(0,Math.min(r.clientY-a.top,a.height))/64,s=6,i=o%1*60,h=Math.round(i/15)*15;let c=s+Math.floor(o),O=h;O===60&&(c+=1,O=0),c=Math.min(Math.max(c,6),20);const I=new Date(n);return I.setHours(c,O,0,0),I},T=(e,n)=>{e.preventDefault();const r=Number(e.dataTransfer.getData("bookingId"));if(!r||!$)return;const a=w.find(d=>d.id===r);a&&(p(!1),v(null),$(a,R(a,n,e)))},M=(e,n)=>{e.dataTransfer.setData("bookingId",n.toString()),e.dataTransfer.effectAllowed="move",p(!0)},S=()=>{p(!1),v(null)},H=Array.from({length:14}).map((e,n)=>6+n),X=e=>{const n=new Date;return n.setHours(e,0,0,0),x(n.toISOString().slice(11,16))},N=e=>{const n=e.numberOfCleanersRequested&&e.numberOfCleanersRequested>0?e.numberOfCleanersRequested:1;return e.durationHours?re(e.durationHours/n):""},q=(e,n)=>{if(!g)return;const r=Number(e.dataTransfer.getData("bookingId"));if(!r||m==="month")return;const a=w.find(s=>s.id===r);if(!a)return;const d=R(a,n,e),o=x(d.toTimeString().slice(0,5));v({key:n.toDateString(),label:o})};return t.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden",children:[t.jsx("div",{className:"bg-primary text-white p-4 sm:p-6",children:t.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-3",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-10 h-10 bg-white/15 backdrop-blur-sm rounded-lg flex items-center justify-center border border-white/10",children:t.jsx(se,{className:"w-6 h-6"})}),t.jsxs("div",{children:[t.jsxs("h2",{className:"text-xl sm:text-2xl font-bold",children:[K," ",Q]}),t.jsx("p",{className:"text-xs sm:text-sm text-white/80",children:"Tap/drag to reschedule"})]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:V,className:"p-2 bg-white/10 rounded-lg hover:bg-white/20 transition-colors border border-white/10",children:t.jsx(ae,{className:"w-5 h-5"})}),t.jsx("button",{onClick:Z,className:"p-2 bg-white/10 rounded-lg hover:bg-white/20 transition-colors border border-white/10",children:t.jsx(ne,{className:"w-5 h-5"})}),t.jsx("div",{className:"ml-2 bg-white/10 rounded-lg flex overflow-hidden border border-white/10",children:["month","week","day"].map(e=>t.jsx("button",{onClick:()=>_(e),className:`px-3 py-2 text-sm font-semibold transition-colors ${m===e?"bg-white text-primary":"text-white/90 hover:bg-white/10"}`,children:e.toUpperCase()},e))}),t.jsxs("button",{onClick:Y,className:"ml-2 sm:ml-4 flex items-center gap-2 px-4 py-2 bg-white text-primary rounded-lg hover:bg-gray-100 transition-colors font-semibold border border-white/20 shadow-sm",children:[t.jsx(le,{className:"w-4 h-4"}),"New Booking"]})]})]})}),g&&t.jsxs("div",{className:"bg-amber-50 border-b border-amber-200 px-4 py-2 text-sm text-amber-800 flex items-center justify-between",children:[t.jsx("span",{children:"Drop on a date to move. You’ll choose “this occurrence” or “entire series”."}),t.jsx("button",{className:"text-amber-700 underline text-xs",onClick:()=>p(!1),children:"Got it"})]}),t.jsxs("div",{className:"p-4",children:[m==="month"&&t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"grid grid-cols-7 gap-[6px] mb-1.5",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(e=>t.jsx("div",{className:"text-center text-xs font-semibold text-gray-600 py-1.5 uppercase tracking-wide",children:e},e))}),t.jsx("div",{className:"grid grid-cols-7 gap-[6px]",children:J.map((e,n)=>{const r=b(f(e)),a=W(e),d=z(e),o=r.length>=5?"busy":r.length>=3?"mid":r.length>0?"light":"free";return t.jsxs("div",{onDragOver:s=>s.preventDefault(),onDrop:s=>T(s,e),onClick:s=>{s.target===s.currentTarget&&A?.()},className:`min-h-[110px] border rounded-lg p-2 ${a?"bg-white border-gray-200":"bg-gray-50 border-gray-100"} ${d?"ring-2 ring-primary ring-offset-1":""} hover:shadow-sm transition`,children:[t.jsxs("div",{className:`flex items-center justify-between text-sm font-semibold mb-2 ${a?"text-gray-900":"text-gray-400"} ${d?"text-primary":""}`,children:[t.jsx("span",{children:e.getDate()}),o!=="free"&&t.jsx("span",{className:`ml-2 text-[10px] px-2 py-0.5 rounded-full font-semibold ${o==="busy"?"bg-red-100 text-red-700":o==="mid"?"bg-amber-100 text-amber-700":"bg-green-100 text-green-700"}`,children:r.length})]}),t.jsxs("div",{className:"space-y-1",children:[r.slice(0,3).map(s=>{const i=P===s.id,h=s.status==="CANCELLED"?"bg-red-50 border-red-200 text-red-700":s.status==="COMPLETED"?"bg-gray-50 border-gray-200 text-gray-700":s.status==="PENDING"?"bg-amber-50 border-amber-200 text-amber-800":"bg-primary/5 border-primary/15 text-gray-900";return t.jsx("div",{draggable:!0,onDragStart:c=>M(c,s.id),onDragEnd:S,className:`p-2 rounded-lg cursor-pointer transition-all border ${h} ${i?"ring-2 ring-primary shadow-md":"hover:bg-primary/10"}`,style:{borderLeft:`4px solid ${s.cleaner?.color??"#163022"}`},onClick:()=>j(s),children:t.jsxs("div",{className:"flex items-center justify-between gap-2",children:[t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("p",{className:"text-xs font-semibold text-gray-900 truncate",children:[s.client.firstName," ",s.client.lastName]}),t.jsxs("p",{className:"text-xs text-gray-600 truncate",children:[s.scheduledTime?x(s.scheduledTime):"—"," • ",s.serviceType]}),s.durationHours&&t.jsxs("p",{className:"text-[11px] text-gray-500 flex items-center gap-1 mt-0.5",children:[t.jsx(oe,{className:"w-3 h-3"}),N(s),s.numberOfCleanersRequested&&s.numberOfCleanersRequested>1?` • ${s.numberOfCleanersRequested} cleaners`:""]})]}),s.checklist&&t.jsx("button",{onClick:c=>{c.stopPropagation(),E?.(s.id)},className:"p-1 rounded-md text-primary hover:bg-primary/10",children:t.jsx(de,{className:"w-4 h-4"})})]})},s.id)}),r.length>3&&t.jsxs("div",{className:"text-[11px] text-gray-500 italic",children:["+",r.length-3," more"]}),r.length===0&&t.jsx("div",{className:"text-xs text-gray-400 italic",children:"No bookings"})]})]},n)})})]}),m==="week"&&t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"grid grid-cols-8 gap-2",children:[t.jsx("div",{className:"text-xs font-semibold text-gray-600 text-right pr-2",children:"Time"}),F().map((e,n)=>t.jsx("div",{className:"text-xs font-semibold text-center text-gray-700",children:f(e).toLocaleDateString(void 0,{weekday:"short",month:"short",day:"numeric"})},n))]}),t.jsxs("div",{className:"grid grid-cols-8 gap-2",children:[t.jsx("div",{className:"space-y-2",children:H.map(e=>t.jsx("div",{className:"h-16 text-xs text-gray-500 text-right pr-2",children:X(e)},e))}),F().map((e,n)=>t.jsxs("div",{className:"relative border border-gray-100 rounded-lg min-h-[900px] bg-gray-50",onDragOver:r=>{r.preventDefault(),q(r,e)},onDrop:r=>T(r,e),children:[g&&y?.key===e.toDateString()&&t.jsxs("div",{className:"absolute top-2 right-2 text-[11px] text-gray-700 bg-white/90 px-2 py-1 rounded border border-gray-200 shadow-sm pointer-events-none",children:["Drop → ",y.label]}),H.map(r=>t.jsx("div",{className:"absolute left-0 right-0 border-t border-gray-200",style:{top:`${(r-6)*64}px`}},r)),b(f(e)).map(r=>{const a=new Date(`${r.scheduledDate}T${r.scheduledTime}`),d=r.durationHours||1,s=(a.getHours()+a.getMinutes()/60-6)*64,i=Math.max(64,d*64);return t.jsxs("div",{draggable:!0,onDragStart:h=>M(h,r.id),onDragEnd:S,onClick:()=>j(r),className:"absolute left-1 right-1 rounded-lg border-l-4 bg-white shadow-sm p-2 cursor-pointer",style:{top:s,height:i,borderLeftColor:r.cleaner?.color||"#163022"},children:[t.jsx("p",{className:"text-xs font-semibold text-gray-900 truncate",children:r.serviceType}),t.jsxs("p",{className:"text-[11px] text-gray-600 truncate",children:[x(r.scheduledTime)," • ",N(r),r.numberOfCleanersRequested&&r.numberOfCleanersRequested>1?` • ${r.numberOfCleanersRequested} cleaners`:""]}),t.jsxs("p",{className:"text-[11px] text-gray-500 truncate",children:[r.client.firstName," ",r.client.lastName]})]},r.id)})]},n))]})]}),m==="day"&&t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("div",{children:t.jsx("p",{className:"text-sm font-semibold text-gray-700",children:l.toLocaleDateString(void 0,{weekday:"long",month:"long",day:"numeric"})})}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:()=>u(new Date(l.getFullYear(),l.getMonth(),l.getDate()-1)),className:"px-3 py-2 border rounded-lg text-sm text-gray-700",children:"Prev"}),t.jsx("button",{onClick:()=>u(new Date),className:"px-3 py-2 border rounded-lg text-sm text-gray-700",children:"Today"}),t.jsx("button",{onClick:()=>u(new Date(l.getFullYear(),l.getMonth(),l.getDate()+1)),className:"px-3 py-2 border rounded-lg text-sm text-gray-700",children:"Next"})]})]}),t.jsxs("div",{className:"relative border border-gray-100 rounded-lg min-h-[900px] bg-gray-50",onDragOver:e=>{e.preventDefault(),q(e,l)},onDrop:e=>T(e,l),children:[g&&y?.key===l.toDateString()&&t.jsxs("div",{className:"absolute top-2 right-2 text-[11px] text-gray-700 bg-white/90 px-2 py-1 rounded border border-gray-200 shadow-sm pointer-events-none",children:["Drop → ",y.label]}),H.map(e=>t.jsx("div",{className:"absolute left-0 right-0 border-t border-gray-200",style:{top:`${(e-6)*64}px`}},e)),b(f(l)).map(e=>{const n=new Date(`${e.scheduledDate}T${e.scheduledTime}`),r=e.durationHours||1,d=(n.getHours()+n.getMinutes()/60-6)*64,o=Math.max(64,r*64);return t.jsxs("div",{draggable:!0,onDragStart:s=>M(s,e.id),onDragEnd:S,onClick:()=>j(e),className:"absolute left-1 right-1 rounded-lg border-l-4 bg-white shadow-sm p-3 cursor-pointer",style:{top:d,height:o,borderLeftColor:e.cleaner?.color||"#163022"},children:[t.jsxs("div",{className:"flex items-center justify-between gap-2",children:[t.jsx("p",{className:"text-sm font-semibold text-gray-900 truncate",children:e.serviceType}),t.jsxs("span",{className:"text-[11px] text-gray-500",children:[N(e),e.numberOfCleanersRequested&&e.numberOfCleanersRequested>1?` • ${e.numberOfCleanersRequested} cleaners`:""]})]}),t.jsxs("p",{className:"text-xs text-gray-600 truncate",children:[x(e.scheduledTime)," • ",N(e),e.numberOfCleanersRequested&&e.numberOfCleanersRequested>1?` • ${e.numberOfCleanersRequested} cleaners`:""]}),t.jsxs("p",{className:"text-xs text-gray-500 truncate",children:[e.client.firstName," ",e.client.lastName]})]},e.id)}),b(l).length===0&&t.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-sm text-gray-500",children:"No bookings for this day."})]})]})]})]})}export{ye as A,fe as a};
