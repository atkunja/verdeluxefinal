import{c as $,a as H,g as v,r,d as f,j as e,A as q,z as n,S as Q,H as V}from"./index-D68JyPnQ.js";import{h as W,i as N,j as G,m as J}from"./adminPortal-KrRNUMwu.js";import{c as X}from"./converter-BdV2bkOJ.js";import{C as Y}from"./credit-card-rY5N0Qov.js";import{F as Z}from"./funnel-Bkw8g59b.js";import{W as K}from"./wallet-wCGWKG4-.js";/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]],te=$("arrow-up-right",ee);/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]],ae=$("refresh-ccw",se),ne=["Marketing","Software","Supplies","Rent","Misc"];function w({label:C,value:i,icon:c,format:h="currency"}){const d=h==="currency"?`$${i.toLocaleString(void 0,{minimumFractionDigits:2})}`:i.toString();return e.jsx("div",{className:"rounded-2xl border border-gray-200 bg-white p-4 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-500",children:C}),e.jsx("div",{className:"text-xl font-semibold text-[#0f172a]",children:d})]}),e.jsx("div",{className:"rounded-full bg-[#f5f3ec] p-2 text-gray-700",children:c})]})})}const me=function(){const i=H();v(i.accounting.getAccountingEntries.queryOptions());const[c,h]=r.useState([]),[d,m]=r.useState([]),[S,A]=r.useState([]),[g,O]=r.useState("all"),[k,D]=r.useState({}),[M,F]=r.useState({}),[re,I]=r.useState({}),[u,E]=r.useState("transactions"),[l,L]=r.useState({method:"ALL",status:"ALL"}),R=f(i.payments.updateTransactionStatus.mutationOptions()),T=f(i.payments.updateTransactionCategory.mutationOptions()),U=f(i.payments.initiateAchPayout.mutationOptions()),p=v(i.accounting.listAccounts.queryOptions(void 0,{staleTime:6e4})),b=v(i.accounting.listTransactions.queryOptions(void 0,{staleTime:3e4}));console.log("BankTransactionsPage render",{accounts:c.length,transactions:d.length}),r.useEffect(()=>{console.log("Accounts Effect run",{data:p.data,isLoading:p.isLoading});const t=p.data?.accounts;t&&Array.isArray(t)&&t.length>0?(console.log("Setting accounts from query data"),h(t.map(s=>({id:s.id||s.external_id||s.account_id||s.name,institution:s.institution||"Mercury",name:s.name||s.account_name||"Account",last4:s.mask||s.last4||"0000",postedBalance:Number(s.balance??s.posted_balance??0),availableBalance:Number(s.available_balance??s.balance??0),lastSynced:new Date().toISOString()})))):(console.log("Setting accounts from mock fallback"),W().then(h))},[p.data]),r.useEffect(()=>{console.log("Transactions Effect run",{data:b.data});const t=b.data?.transactions;t&&Array.isArray(t)&&t.length>0?m(t.map(s=>({id:s.externalId||s.id?.toString()||Math.random().toString(36).slice(2),accountId:s.accountId||s.account_id||"unknown",date:(s.transactionAt||s.date||s.created_at||"").toString().slice(0,10),description:s.description||s.memo||"Transaction",accountName:s.accountName||s.account||"Account",category:s.category||"Uncategorized",amount:Number(s.amount??s.debit??0)||0,status:s.status||"pending"}))):N().then(m)},[b.data]),r.useEffect(()=>{console.log("Payments Effect run"),G().then(A)},[]);const y=r.useMemo(()=>{const t=c.reduce((a,o)=>a+o.postedBalance,0),s=c.reduce((a,o)=>a+o.availableBalance,0);return{totalBalance:t,availableBalance:s,activeAccounts:c.length}},[c]),B=r.useMemo(()=>g==="all"?d:d.filter(t=>t.status===g),[d,g]),P=(t,s)=>{R.mutate({id:t,status:s},{onSuccess:()=>{N().then(m),I(a=>({...a,[t]:s==="posted"})),n.success(`Marked ${s}`)},onError:a=>n.error(a.message||"Update failed")})},_=r.useMemo(()=>S.filter(t=>{const s=l.method==="ALL"||t.paymentMethod===l.method,a=l.status==="ALL"||t.status===l.status;return s&&a}),[S,l]),j=(t,s)=>{A(a=>a.map(o=>o.id===t?{...o,status:s}:o)),n.success(`Marked ${s}`)},z=(t,s)=>{D(a=>({...a,[t]:s})),m(a=>a.map(o=>o.id===t?{...o,category:s}:o))};return e.jsxs(q,{title:"Bank Transactions",subtitle:"Mercury mock integration.",actions:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 rounded-xl border border-gray-200 bg-white p-1 text-sm",children:[e.jsx("button",{onClick:()=>E("transactions"),className:`rounded-lg px-3 py-1.5 font-semibold ${u==="transactions"?"bg-[#163022] text-white":"text-gray-700"}`,children:"Transactions"}),e.jsx("button",{onClick:()=>E("payments"),className:`rounded-lg px-3 py-1.5 font-semibold ${u==="payments"?"bg-[#163022] text-white":"text-gray-700"}`,children:"Payments"})]}),e.jsxs("button",{onClick:()=>n("Category management coming soon",{icon:"ðŸ› ï¸"}),className:"inline-flex items-center gap-2 rounded-xl border border-gray-200 bg-white px-3 py-2 text-sm font-semibold text-gray-700 hover:bg-gray-50",children:[e.jsx(Q,{className:"h-4 w-4"}),"Manage Categories"]}),e.jsxs("button",{onClick:()=>{const t=u==="transactions"?B:_;if(!t||t.length===0){n.error("No data to export");return}const s=X.json2csv(t),a=new Blob([s],{type:"text/csv"}),o=window.URL.createObjectURL(a),x=document.createElement("a");x.setAttribute("hidden",""),x.setAttribute("href",o),x.setAttribute("download",`v_luxe_${u}_${new Date().toISOString().split("T")[0]}.csv`),document.body.appendChild(x),x.click(),document.body.removeChild(x),n.success(`Exported ${t.length} rows`)},className:"inline-flex items-center gap-2 rounded-xl border border-gray-200 bg-white px-3 py-2 text-sm font-semibold text-gray-700 hover:bg-gray-50",children:[e.jsx(V,{className:"h-4 w-4"}),"Export CSV"]}),e.jsxs("button",{onClick:()=>{n.loading("Syncing with Mercury...",{duration:2e3}),setTimeout(()=>{N().then(m),n.success("Sync complete")},2e3)},className:"inline-flex items-center gap-2 rounded-xl bg-[#163022] px-3 py-2 text-sm font-semibold text-white shadow hover:bg-[#0f241a]",children:[e.jsx(ae,{className:"h-4 w-4"}),"Sync Transactions"]})]}),children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsx(w,{label:"Total Balance",value:y.totalBalance,icon:e.jsx(Y,{className:"h-5 w-5"})}),e.jsx(w,{label:"Available Balance",value:y.availableBalance,icon:e.jsx(te,{className:"h-5 w-5 text-green-600"})}),e.jsx(w,{label:"Active Accounts",value:y.activeAccounts,format:"number",icon:e.jsx(Z,{className:"h-5 w-5 text-gray-600"})})]}),e.jsxs("div",{className:"mt-4 grid gap-4 lg:grid-cols-2",children:[e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white p-4 shadow-sm",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsx("div",{className:"text-lg font-semibold text-[#0f172a]",children:"Accounts"}),e.jsx("button",{onClick:()=>n("Rules engine coming soon",{icon:"ðŸ§ "}),className:"rounded-lg border border-gray-200 px-3 py-1.5 text-xs font-semibold text-gray-700 hover:bg-gray-50",children:"Manage Rules"})]}),e.jsx("div",{className:"space-y-3",children:c.map(t=>e.jsxs("div",{className:"flex items-center justify-between rounded-xl border border-gray-200 bg-[#f9fafb] p-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-semibold text-[#0f172a]",children:[t.institution," â€¢ ",t.name]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["â€¢â€¢â€¢â€¢ ",t.last4]}),e.jsxs("div",{className:"text-[11px] text-gray-500",children:["Synced ",new Date(t.lastSynced).toLocaleString()]})]}),e.jsxs("div",{className:"text-right text-sm",children:[e.jsxs("div",{className:"font-semibold text-[#0f172a]",children:["$",t.postedBalance.toLocaleString(void 0,{minimumFractionDigits:2})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["Available $",t.availableBalance.toLocaleString(void 0,{minimumFractionDigits:2})]})]})]},t.id))})]}),u==="transactions"?e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-700",children:[e.jsx("span",{className:"font-semibold",children:"Filters:"}),e.jsx("div",{className:"flex gap-2 rounded-xl border border-gray-200 bg-[#f9fafb] p-1",children:["all","posted","pending","excluded"].map(t=>e.jsx("button",{onClick:()=>O(t),className:`rounded-lg px-3 py-1.5 text-xs font-semibold ${g===t?"bg-[#163022] text-white":"text-gray-700"}`,children:t[0].toUpperCase()+t.slice(1)},t))})]}),e.jsx("div",{className:"mt-3 max-h-[420px] overflow-y-auto",children:e.jsxs("table",{className:"min-w-full text-left text-xs",children:[e.jsx("thead",{className:"sticky top-0 bg-white text-[11px] text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-2",children:"Date"}),e.jsx("th",{className:"px-2 py-2",children:"Description"}),e.jsx("th",{className:"px-2 py-2",children:"Account"}),e.jsx("th",{className:"px-2 py-2",children:"Category"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Amount"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Status"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:B.map(t=>e.jsxs("tr",{className:"hover:bg-[#f9fafb]",children:[e.jsx("td",{className:"px-2 py-2",children:t.date}),e.jsx("td",{className:"px-2 py-2",children:t.description}),e.jsx("td",{className:"px-2 py-2",children:t.accountName}),e.jsx("td",{className:"px-2 py-2",children:e.jsx("select",{value:k[t.id]||t.category,onChange:s=>{z(t.id,s.target.value),T.mutate({id:t.id,category:s.target.value,subCategory:M[t.id]},{onSuccess:()=>n.success("Category saved"),onError:a=>n.error(a.message||"Save failed")})},className:"rounded-lg border border-gray-200 bg-white px-2 py-1 text-xs",children:J.map(s=>e.jsx("option",{value:s,children:s},s))})}),e.jsx("td",{className:"px-2 py-2",children:e.jsxs("select",{value:M[t.id]||"Uncategorized",onChange:s=>{F(a=>({...a,[t.id]:s.target.value})),T.mutate({id:t.id,category:k[t.id]||t.category,subCategory:s.target.value},{onSuccess:()=>n.success("Sub-category saved"),onError:a=>n.error(a.message||"Save failed")})},className:"rounded-lg border border-gray-200 bg-white px-2 py-1 text-xs",children:[e.jsx("option",{children:"Uncategorized"}),ne.map(s=>e.jsx("option",{value:s,children:s},s))]})}),e.jsxs("td",{className:`px-2 py-2 text-right font-semibold ${t.amount<0?"text-red-600":"text-green-700"}`,children:[t.amount<0?"-":"+","$",Math.abs(t.amount).toFixed(2)]}),e.jsx("td",{className:"px-2 py-2 text-right capitalize text-gray-700",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("span",{className:"text-xs",children:t.status}),e.jsx("button",{onClick:()=>P(t.id,"posted"),className:"rounded-lg border border-gray-200 bg-white px-2 py-1 text-[11px] text-green-700 hover:bg-green-50",children:"Approve"}),e.jsx("button",{onClick:()=>P(t.id,"excluded"),className:"rounded-lg border border-gray-200 bg-white px-2 py-1 text-[11px] text-amber-700 hover:bg-amber-50",children:"Exclude"}),e.jsx("button",{onClick:()=>U.mutate({paymentIds:[t.id]},{onSuccess:()=>n.success("ACH payout initiated"),onError:s=>n.error(s.message||"ACH failed")}),className:"rounded-lg border border-gray-200 bg-white px-2 py-1 text-[11px] text-blue-700 hover:bg-blue-50",children:"ACH"})]})})]},t.id))})]})})]}):e.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-lg font-semibold text-[#0f172a]",children:"Cleaner Payments"}),e.jsxs("button",{onClick:()=>n("Bulk payouts coming soon",{icon:"ðŸ’¸"}),className:"inline-flex items-center gap-2 rounded-lg bg-[#163022] px-3 py-2 text-xs font-semibold text-white shadow hover:bg-[#0f241a]",children:[e.jsx(K,{className:"h-4 w-4"}),"Run Payouts"]})]}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2 text-xs text-gray-700",children:[e.jsxs("select",{value:l.method,onChange:t=>L(s=>({...s,method:t.target.value})),className:"rounded-lg border border-gray-200 bg-white px-2 py-1",children:[e.jsx("option",{value:"ALL",children:"All methods"}),e.jsx("option",{value:"ACH",children:"ACH"}),e.jsx("option",{value:"Check",children:"Check"}),e.jsx("option",{value:"Cash",children:"Cash"})]}),e.jsxs("select",{value:l.status,onChange:t=>L(s=>({...s,status:t.target.value})),className:"rounded-lg border border-gray-200 bg-white px-2 py-1",children:[e.jsx("option",{value:"ALL",children:"All statuses"}),e.jsx("option",{value:"owed",children:"Owed"}),e.jsx("option",{value:"in_process",children:"In Process"}),e.jsx("option",{value:"paid",children:"Paid"})]})]}),e.jsx("div",{className:"mt-3 max-h-[420px] overflow-y-auto",children:e.jsxs("table",{className:"min-w-full text-left text-xs",children:[e.jsx("thead",{className:"sticky top-0 bg-white text-[11px] text-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-2 py-2",children:"Service Date"}),e.jsx("th",{className:"px-2 py-2",children:"Cleaner"}),e.jsx("th",{className:"px-2 py-2",children:"Booking"}),e.jsx("th",{className:"px-2 py-2",children:"Method"}),e.jsx("th",{className:"px-2 py-2",children:"Status"}),e.jsx("th",{className:"px-2 py-2 text-right",children:"Amount"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-100",children:_.map(t=>e.jsxs("tr",{className:"hover:bg-[#f9fafb]",children:[e.jsx("td",{className:"px-2 py-2",children:t.serviceDate}),e.jsx("td",{className:"px-2 py-2",children:t.cleaner}),e.jsx("td",{className:"px-2 py-2",children:t.bookingId}),e.jsx("td",{className:"px-2 py-2",children:t.paymentMethod}),e.jsx("td",{className:"px-2 py-2",children:e.jsx("span",{className:`rounded-full px-2 py-1 text-[11px] font-semibold ${t.status==="owed"?"bg-amber-50 text-amber-700":t.status==="in_process"?"bg-blue-50 text-blue-700":"bg-green-50 text-green-700"}`,children:t.status})}),e.jsxs("td",{className:"px-2 py-2 text-right font-semibold text-[#0f172a]",children:["$",t.amount.toFixed(2)]}),e.jsx("td",{className:"px-2 py-2 text-right",children:e.jsxs("div",{className:"flex justify-end gap-2 text-[11px]",children:[e.jsx("button",{onClick:()=>j(t.id,"owed"),className:"rounded-lg border border-gray-200 bg-white px-2 py-1 text-xs text-gray-700 hover:bg-gray-50",children:"Owed"}),e.jsx("button",{onClick:()=>j(t.id,"in_process"),className:"rounded-lg border border-gray-200 bg-white px-2 py-1 text-xs text-blue-700 hover:bg-blue-50",children:"In Process"}),e.jsx("button",{onClick:()=>{j(t.id,"paid"),n.success("Marked paid")},className:"rounded-lg border border-gray-200 bg-white px-2 py-1 text-xs text-green-700 hover:bg-green-50",children:"Paid"})]})})]},t.id))})]})})]})]})]})};export{me as component};
