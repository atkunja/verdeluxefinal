import{j as t,u as h,a as A,b as y,k as c,d,z as n}from"./index-D68JyPnQ.js";import{u as C}from"./BookingWizardProvider-CZ44CSfS.js";import{b as k}from"./analytics-Cg1IkZOG.js";import{Q as j}from"./QuizIdentityLayout-_IpR82wO.js";function N(){const o=h(),u=A(),{draft:r}=C(),l=y(e=>e.setAuth),[p,f]=c.useState("Setting up your account..."),x=d(u.register.mutationOptions()),b=d(u.login.mutationOptions()),m=c.useRef(!1),g="TempPass123!@";return c.useEffect(()=>{if(m.current)return;m.current=!0;const e=r.contact.email;if(console.log("[CreateAccount] Starting automated registration for:",e),!e){console.error("[CreateAccount] Missing required data:",{email:!!e,tempPassword:!0}),n.error("Missing email or configuration. Please restart."),o({to:"/booking-quiz/start"});return}k.selectionMade("create-account",e),x.mutate({email:e,password:g,role:"CLIENT",firstName:r.contact.fullName?.split(" ")[0],lastName:r.contact.fullName?.split(" ").slice(1).join(" ")||void 0,phone:r.contact.phone},{onSuccess:s=>{l(s.token,s.user),n.success("Account created!"),o({to:"/booking-quiz/clean/type"})},onError:s=>{console.log("[CreateAccount] Register failed, checking for existing account:",s.message);const i=s.message?.toLowerCase()||"";i.includes("already registered")||i.includes("email_exists")||i.includes("conflict")?(console.log("[CreateAccount] Detected existing account, attempting login with temp password..."),f("Logging you in..."),b.mutate({email:e,password:g},{onSuccess:a=>{console.log("[CreateAccount] Login successful!"),l(a.token,a.user),n.success("Welcome back!"),o({to:"/booking-quiz/clean/type"})},onError:a=>{console.error("[CreateAccount] Login failed:",a.message),n.error("Account exists but login failed. Please try the 'Returning Customer' flow."),o({to:"/booking-quiz/returning/phone"})}})):(n.error(s.message||"Failed to create account"),o({to:"/booking-quiz/start"}))}})},[]),t.jsx(j,{title:"Almost there...",subtitle:"We're creating your premium profile and curating your bespoke clean.",children:t.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[t.jsxs("div",{className:"relative w-20 h-20",children:[t.jsx("div",{className:"absolute inset-0 border-4 border-[#163022]/10 rounded-full"}),t.jsx("div",{className:"absolute inset-0 border-4 border-[#163022] rounded-full border-t-transparent animate-spin"})]}),t.jsx("h2",{className:"text-xl font-bold mt-8 text-[#163022]",children:p}),t.jsx("p",{className:"mt-2 text-sm text-[#5c5a55]",children:"Initializing your Verde Luxe experience..."})]})})}const L=function(){return t.jsx(N,{})};export{L as component};
